# Copyright (C) 2023, Wazuh Inc.
#
# This program is free software; you can redistribute it
# and/or modify it under the terms of the GNU General Public
# License (version 2) as published by the FSF - Free Software
# Foundation
#
# CIS Benchmark for Alma Linux 10
# This document provides prescriptive guidance for establishing a secure configuration posture for Alma Linux 10 systems running on x86 and x64 platforms. This document was tested against Alma Linux 10. This document is based on Center for Internet Security Alma Linux 9 Benchmark v1.0.0.
#
# Reference: https://www.cisecurity.org/cis-benchmarks/
#
# [Application name] [any or all] [reference]
# type:<entry name>;
#
# Type can be:
#             - f (for file or directory)
#             - p (process running)
#             - d (any file inside the directory)
#             - c (command output)
#
# Values can be preceded by: =: (for equal) - default
#                             r: (for ossec regexes)
#                             >: (for strcmp greater)
#                             <: (for strcmp  lower)
# Multiple patterns can be specified by using " && " between them.
# (All of them must match for it to return true).


# Check Alma Linux platform.
[Requirements for running the policy against Alma Linux 10.] [required] []
f:/etc/redhat-release -> r:^AlmaLinux && r:release 10;


$sshd_file=/etc/ssh/sshd_config;


# 38000 Ensure mounting of squashfs filesystems is disabled.
# The squashfs filesystem type is a compressed read-only Linux filesystem embedded in small footprint ...
[CIS - Alma Linux 10 - Ensure mounting of squashfs filesystems is disabled. {CIS: 1.1.1.1} {PCI_DSS: 1.1.6, 1.2.1}] [all] [https://www.cisecurity.org/ CIS: 1.1.1.1]
c:modprobe -n -v squashfs -> r:install /bin/false|Module squashfs not found;
!c:lsmod -> r:squashfs;
d:/etc/modprobe.d -> r:.*\.conf -> r:blacklist\t*\s*squashfs;

# 38001 Ensure mounting of udf filesystems is disabled.
# The udf filesystem type is the universal disk format used to implement ISO/IEC 13346 and ECMA-167 sp...
[CIS - Alma Linux 10 - Ensure mounting of udf filesystems is disabled. {CIS: 1.1.1.2} {PCI_DSS: 1.1.6, 1.2.1}] [all] [https://www.cisecurity.org/ CIS: 1.1.1.2]
c:modprobe -n -v udf -> r:install /bin/false|Module udf not found;
!c:lsmod -> r:udf;
d:/etc/modprobe.d -> r:.*\.conf -> r:blacklist\t*\s*udf;

# 38002 Ensure /tmp is a separate partition.
# The /tmp directory is a world-writable directory used for temporary storage by all users and some ap...
[CIS - Alma Linux 10 - Ensure /tmp is a separate partition. {CIS: 1.1.2.1} {PCI_DSS: 1.1.6, 1.2.1}] [all] [https://www.cisecurity.org/ CIS: 1.1.2.1]
c:findmnt --kernel /tmp -> r:^/tmp\s;
c:systemctl is-enabled tmp.mount -> r:enabled|static|generated;

# 38003 Ensure nodev option set on /tmp partition.
# The nodev mount option specifies that the filesystem cannot contain special devices.
[CIS - Alma Linux 10 - Ensure nodev option set on /tmp partition. {CIS: 1.1.2.2} {PCI_DSS: 1.1.6, 1.2.1}] [all] [https://www.cisecurity.org/ CIS: 1.1.2.2]
c:findmnt --kernel /tmp -> r:^/tmp\s && r:nodev;

# 38004 Ensure noexec option set on /tmp partition.
# The noexec mount option specifies that the filesystem cannot contain executable binaries.
[CIS - Alma Linux 10 - Ensure noexec option set on /tmp partition. {CIS: 1.1.2.3} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 1.1.2.3]
c:findmnt --kernel /tmp -> r:^/tmp\s && r:noexec;

# 38005 Ensure nosuid option set on /tmp partition.
# The nosuid mount option specifies that the filesystem cannot contain setuid files.
[CIS - Alma Linux 10 - Ensure nosuid option set on /tmp partition. {CIS: 1.1.2.4} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 1.1.2.4]
c:findmnt --kernel /tmp -> r:^/tmp\s && r:nosuid;

# 38006 Ensure separate partition exists for /var.
# The /var directory is used by daemons and other system services to temporarily store dynamic data. S...
[CIS - Alma Linux 10 - Ensure separate partition exists for /var. {CIS: 1.1.3.1} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 1.1.3.1]
c:findmnt --kernel /var -> r:^/var\s;

# 38007 Ensure nodev option set on /var partition.
# The nodev mount option specifies that the filesystem cannot contain special devices.
[CIS - Alma Linux 10 - Ensure nodev option set on /var partition. {CIS: 1.1.3.2} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 1.1.3.2]
c:findmnt --kernel /var -> r:^/var\s && r:nodev;

# 38008 Ensure nosuid option set on /var partition.
# The nosuid mount option specifies that the filesystem cannot contain setuid files.
[CIS - Alma Linux 10 - Ensure nosuid option set on /var partition. {CIS: 1.1.3.3} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 1.1.3.3]
c:findmnt --kernel /var -> r:^/var\s && r:nosuid;

# 38009 Ensure separate partition exists for /var/tmp.
# The /var/tmp directory is a world-writable directory used for temporary storage by all users and som...
[CIS - Alma Linux 10 - Ensure separate partition exists for /var/tmp. {CIS: 1.1.4.1} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 1.1.4.1]
c:findmnt --kernel /var/tmp -> r:^/var/tmp\s;

# 38010 Ensure noexec option set on /var/tmp partition.
# The noexec mount option specifies that the filesystem cannot contain executable binaries.
[CIS - Alma Linux 10 - Ensure noexec option set on /var/tmp partition. {CIS: 1.1.4.2} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 1.1.4.2]
c:findmnt --kernel /var/tmp -> r:^/var/tmp\s && r:noexec;

# 38011 Ensure nosuid option set on /var/tmp partition.
# The nosuid mount option specifies that the filesystem cannot contain setuid files.
[CIS - Alma Linux 10 - Ensure nosuid option set on /var/tmp partition. {CIS: 1.1.4.3} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 1.1.4.3]
c:findmnt --kernel /var/tmp -> r:^/var/tmp\s && r:nosuid;

# 38012 Ensure nodev option set on /var/tmp partition.
# The nodev mount option specifies that the filesystem cannot contain special devices.
[CIS - Alma Linux 10 - Ensure nodev option set on /var/tmp partition. {CIS: 1.1.4.4} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 1.1.4.4]
c:findmnt --kernel /var/tmp -> r:^/var/tmp\s && r:nodev;

# 38013 Ensure separate partition exists for /var/log.
# The /var/log directory is used by system services to store log data.
[CIS - Alma Linux 10 - Ensure separate partition exists for /var/log. {CIS: 1.1.5.1} {PCI_DSS: 10.7}] [all] [https://www.cisecurity.org/ CIS: 1.1.5.1]
c:findmnt --kernel /var/log -> r:^/var/log\s;

# 38014 Ensure nodev option set on /var/log partition.
# The nodev mount option specifies that the filesystem cannot contain special devices.
[CIS - Alma Linux 10 - Ensure nodev option set on /var/log partition. {CIS: 1.1.5.2} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 1.1.5.2]
c:findmnt --kernel /var/log -> r:^/var/log\s && r:nodev;

# 38015 Ensure noexec option set on /var/log partition.
# The noexec mount option specifies that the filesystem cannot contain executable binaries.
[CIS - Alma Linux 10 - Ensure noexec option set on /var/log partition. {CIS: 1.1.5.3} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 1.1.5.3]
c:findmnt --kernel /var/log -> r:^/var/log\s && r:noexec;

# 38016 Ensure nosuid option set on /var/log partition.
# The nosuid mount option specifies that the filesystem cannot contain setuid files.
[CIS - Alma Linux 10 - Ensure nosuid option set on /var/log partition. {CIS: 1.1.5.4} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 1.1.5.4]
c:findmnt --kernel /var/log -> r:^/var/log\s && r:nosuid;

# 38017 Ensure separate partition exists for /var/log/audit.
# The auditing daemon, auditd, stores log data in the /var/log/audit directory.
[CIS - Alma Linux 10 - Ensure separate partition exists for /var/log/audit. {CIS: 1.1.6.1} {PCI_DSS: 10.7}] [all] [https://www.cisecurity.org/ CIS: 1.1.6.1]
c:findmnt --kernel /var/log/audit -> r:^/var/log/audit\s;

# 38018 Ensure noexec option set on /var/log/audit partition.
# The noexec mount option specifies that the filesystem cannot contain executable binaries.
[CIS - Alma Linux 10 - Ensure noexec option set on /var/log/audit partition. {CIS: 1.1.6.2} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 1.1.6.2]
c:findmnt --kernel /var/log/audit -> r:^/var/log/audit\s && r:noexec;

# 38019 Ensure nodev option set on /var/log/audit partition.
# The nodev mount option specifies that the filesystem cannot contain special devices.
[CIS - Alma Linux 10 - Ensure nodev option set on /var/log/audit partition. {CIS: 1.1.6.3} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 1.1.6.3]
c:findmnt --kernel /var/log/audit -> r:^/var/log/audit\s && r:nodev;

# 38020 Ensure nosuid option set on /var/log/audit partition.
# The nosuid mount option specifies that the filesystem cannot contain setuid files.
[CIS - Alma Linux 10 - Ensure nosuid option set on /var/log/audit partition. {CIS: 1.1.6.4} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 1.1.6.4]
c:findmnt --kernel /var/log/audit -> r:^/var/log/audit\s && r:nosuid;

# 38021 Ensure separate partition exists for /home.
# The /home directory is used to support disk storage needs of local users.
[CIS - Alma Linux 10 - Ensure separate partition exists for /home. {CIS: 1.1.7.1} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 1.1.7.1]
c:findmnt --kernel /home -> r:^/home\s;

# 38022 Ensure nodev option set on /home partition.
# The nodev mount option specifies that the filesystem cannot contain special devices.
[CIS - Alma Linux 10 - Ensure nodev option set on /home partition. {CIS: 1.1.7.2} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 1.1.7.2]
c:findmnt --kernel /home -> r:^/home\s && r:nodev;

# 38023 Ensure nosuid option set on /home partition.
# The nosuid mount option specifies that the filesystem cannot contain setuid files.
[CIS - Alma Linux 10 - Ensure nosuid option set on /home partition. {CIS: 1.1.7.3} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 1.1.7.3]
c:findmnt --kernel /home -> r:^/home\s && r:nosuid;

# 38024 Ensure /dev/shm is a separate partition.
# The /dev/shm directory is a world-writable directory that can function as shared memory that facilit...
[CIS - Alma Linux 10 - Ensure /dev/shm is a separate partition. {CIS: 1.1.8.1} {PCI_DSS: 1.1.6, 1.2.1}] [all] [https://www.cisecurity.org/ CIS: 1.1.8.1]
c:findmnt --kernel /dev/shm -> r:^/dev/shm\s;

# 38025 Ensure nodev option set on /dev/shm partition.
# The nodev mount option specifies that the filesystem cannot contain special devices.
[CIS - Alma Linux 10 - Ensure nodev option set on /dev/shm partition. {CIS: 1.1.8.2} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 1.1.8.2]
c:findmnt --kernel /dev/shm -> r:^/dev/shm\s && r:nodev;

# 38026 Ensure noexec option set on /dev/shm partition.
# The noexec mount option specifies that the filesystem cannot contain executable binaries.
[CIS - Alma Linux 10 - Ensure noexec option set on /dev/shm partition. {CIS: 1.1.8.3} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 1.1.8.3]
c:findmnt --kernel /dev/shm -> r:^/dev/shm\s && r:noexec;

# 38027 Ensure nosuid option set on /dev/shm partition.
# The nosuid mount option specifies that the filesystem cannot contain setuid files.
[CIS - Alma Linux 10 - Ensure nosuid option set on /dev/shm partition. {CIS: 1.1.8.4} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 1.1.8.4]
c:findmnt --kernel /dev/shm -> r:^/dev/shm\s && r:nosuid;

# 38028 Disable USB Storage.
# USB storage provides a means to transfer and store files ensuring persistence and availability of th...
[CIS - Alma Linux 10 - Disable USB Storage. {CIS: 1.1.9}] [all] [https://www.cisecurity.org/ CIS: 1.1.9]
c:modprobe -n -v usb-storage -> r:^install /bin/true;
!c:lsmod -> r:^usb-storage;

# 38029 Ensure gpgcheck is globally activated.
# The gpgcheck option, found in the main section of the /etc/dnf/dnf.conf and individual /etc/yum.repo...
[CIS - Alma Linux 10 - Ensure gpgcheck is globally activated. {CIS: 1.2.2} {PCI_DSS: 6.2}] [all] [https://www.cisecurity.org/ CIS: 1.2.2]
f:/etc/dnf/dnf.conf -> r:^\s*gpgcheck\s*=\s*1;
!c:grep -Rh ^gpgcheck /etc/yum.repos.d/ -> r:gpgcheck\s*=\s*0;

# 38030 Ensure AIDE is installed.
# Advanced Intrusion Detection Environment (AIDE) is a intrusion detection tool that uses predefined r...
[CIS - Alma Linux 10 - Ensure AIDE is installed. {CIS: 1.3.1} {PCI_DSS: 10.2.1, 11.5}] [all] [https://www.cisecurity.org/ CIS: 1.3.1]
c:rpm -q aide -> r:aide-;

# 38031 Ensure filesystem integrity is regularly checked.
# Periodic checking of the filesystem integrity is needed to detect changes to the filesystem.
[CIS - Alma Linux 10 - Ensure filesystem integrity is regularly checked. {CIS: 1.3.2} {PCI_DSS: 10.2.1, 11.5}] [all] [https://www.cisecurity.org/ CIS: 1.3.2]
c:systemctl is-enabled aidecheck.service -> r:^enable;
c:systemctl is-enabled aidecheck.timer -> r:^enable;
c:systemctl status aidecheck.service -> r:active;

# 38032 Ensure cryptographic mechanisms are used to protect the integrity of audit tools.
# Audit tools include, but are not limited to, vendor-provided and open source audit tools needed to s...
[CIS - Alma Linux 10 - Ensure cryptographic mechanisms are used to protect the integrity of audit tools. {CIS: 4.1.4.11}] [all] [https://www.cisecurity.org/ CIS: 4.1.4.11]
f:/etc/aide/aide.conf;
f:/etc/aide/aide.conf -> r:/sbin/auditctl\s*\t*p[*!+-]i[*!+-]n[*!+-]u[*!+-]g[*!+-]s[*!+-]b[*!+-]acl[*!+-]xattrs[*!+-]sha512;
f:/etc/aide/aide.conf -> r:/sbin/auditd\s*\t*p[*!+-]i[*!+-]n[*!+-]u[*!+-]g[*!+-]s[*!+-]b[*!+-]acl[*!+-]xattrs[*!+-]sha512;
f:/etc/aide/aide.conf -> r:/sbin/ausearch\s*\t*p[*!+-]i[*!+-]n[*!+-]u[*!+-]g[*!+-]s[*!+-]b[*!+-]acl[*!+-]xattrs[*!+-]sha512;
f:/etc/aide/aide.conf -> r:/sbin/aureport\s*\t*p[*!+-]i[*!+-]n[*!+-]u[*!+-]g[*!+-]s[*!+-]b[*!+-]acl[*!+-]xattrs[*!+-]sha512;
f:/etc/aide/aide.conf -> r:/sbin/autrace\s*\t*p[*!+-]i[*!+-]n[*!+-]u[*!+-]g[*!+-]s[*!+-]b[*!+-]acl[*!+-]xattrs[*!+-]sha512;
f:/etc/aide/aide.conf -> r:/sbin/augenrules\s*\t*p[*!+-]i[*!+-]n[*!+-]u[*!+-]g[*!+-]s[*!+-]b[*!+-]acl[*!+-]xattrs[*!+-]sha512;

# 38033 Ensure bootloader password is set.
# Setting the boot loader password will require that anyone rebooting the system must enter a password...
[CIS - Alma Linux 10 - Ensure bootloader password is set. {CIS: 1.4.1} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 1.4.1]
f:/boot/grub2/grub.cfg -> r:^\s*\t*set superusers;
f:/boot/grub2/grub.cfg -> r:^\s*\t*password;

# 38034 Ensure permissions on bootloader config are configured.
# The grub files contain information on boot settings and passwords for unlocking boot options.
[CIS - Alma Linux 10 - Ensure permissions on bootloader config are configured. {CIS: 1.4.2} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 1.4.2]
c:stat -L /boot/grub2/grub.cfg -> r:Access:\s*\(0700/-r--------\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\);
c:stat -L /boot/grub2/grubenv -> r:Access:\s*\(0600/-r--------\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\);
c:stat -L /boot/grub2/user.cfg -> r:Access:\s*\(0600/-r--------\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\);

# 38035 Ensure core dump storage is disabled.
# A core dump is the memory of an executable program. It is generally used to determine why a program ...
[CIS - Alma Linux 10 - Ensure core dump storage is disabled. {CIS: 1.5.1}] [all] [https://www.cisecurity.org/ CIS: 1.5.1]
f:/etc/systemd/coredump.conf -> r:^\s*Storage\s*=\s*none;

# 38036 Ensure core dump backtraces are disabled.
# A core dump is the memory of an executable program. It is generally used to determine why a program ...
[CIS - Alma Linux 10 - Ensure core dump backtraces are disabled. {CIS: 1.5.2}] [all] [https://www.cisecurity.org/ CIS: 1.5.2]
f:/etc/systemd/coredump.conf -> r:^\s*ProcessSizeMax\s*=\s*0;

# 38037 Ensure SELinux is installed.
# SELinux provides Mandatory Access Control.
[CIS - Alma Linux 10 - Ensure SELinux is installed. {CIS: 1.6.1.1} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 1.6.1.1]
c:rpm -q libselinux -> r:^libselinux-;

# 38038 Ensure SELinux is not disabled in bootloader configuration.
# Configure SELINUX to be enabled at boot time and verify that it has not been overwritten by the grub...
[CIS - Alma Linux 10 - Ensure SELinux is not disabled in bootloader configuration. {CIS: 1.6.1.2} {PCI_DSS: 7.1, 7.1.1}] [any] [https://www.cisecurity.org/ CIS: 1.6.1.2]
f:/boot/grub2/grubenv -> r:kernelopts=.*selinux=0|kernelopts=.*enforcing=0;
f:/boot/grub2/grub.cfg -> r:kernelopts=.*selinux=0|kernelopts=.*enforcing=0;

# 38039 Ensure SELinux policy is configured.
# Configure SELinux to meet or exceed the default targeted policy, which constrains daemons and system...
[CIS - Alma Linux 10 - Ensure SELinux policy is configured. {CIS: 1.6.1.3} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 1.6.1.3]
c:sestatus -> r:^Loaded policy name:\s+targeted$|^Loaded policy name:\s+mls$;
f:/etc/selinux/config -> r:^\s*SELINUXTYPE\s*=\s*targeted|^\s*SELINUXTYPE\s*=\s*mls;

# 38040 Ensure the SELinux mode is not disabled.
# SELinux can run in one of three modes: disabled, permissive, or enforcing: - Enforcing - Is the defa...
[CIS - Alma Linux 10 - Ensure the SELinux mode is not disabled. {CIS: 1.6.1.4} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 1.6.1.4]
c:getenforce -> r:^Enforcing$|^Permissive$;
f:/etc/selinux/config -> r:^\s*SELINUX\s*=\s*enforcing|\s*SELINUX\s*=\s*permisive;

# 38041 Ensure the SELinux mode is enforcing.
# SELinux can run in one of three modes: disabled, permissive, or enforcing: - Enforcing - Is the defa...
[CIS - Alma Linux 10 - Ensure the SELinux mode is enforcing. {CIS: 1.6.1.5} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 1.6.1.5]
c:getenforce -> r:^Enforcing$;
f:/etc/selinux/config -> r:^\s*SELINUX\s*=\s*enforcing;

# 38042 Ensure no unconfined services exist.
# Unconfined processes run in unconfined domains.
[CIS - Alma Linux 10 - Ensure no unconfined services exist. {CIS: 1.6.1.6} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 1.6.1.6]
!c:ps -eZ -> r:unconfined_service_t;

# 38043 Ensure SETroubleshoot is not installed.
# The SETroubleshoot service notifies desktop users of SELinux denials through a user-friendly interfa...
[CIS - Alma Linux 10 - Ensure SETroubleshoot is not installed. {CIS: 1.6.1.7} {PCI_DSS: 1.1.6, 1.2.1}] [all] [https://www.cisecurity.org/ CIS: 1.6.1.7]
!c:rpm -qa setroubleshoot -> r:^setroubleshoot;

# 38044 Ensure the MCS Translation Service (mcstrans) is not installed.
# The mcstransd daemon provides category label information to client processes requesting information....
[CIS - Alma Linux 10 - Ensure the MCS Translation Service (mcstrans) is not installed. {CIS: 1.6.1.8} {PCI_DSS: 1.1.6, 1.2.1}] [all] [https://www.cisecurity.org/ CIS: 1.6.1.8]
!c:rpm -qa mcstrans -> r:mcstrans;

# 38045 Ensure message of the day is configured properly.
# The contents of the /etc/motd file are displayed to users after login and function as a message of t...
[CIS - Alma Linux 10 - Ensure message of the day is configured properly. {CIS: 1.7.1}] [all] [https://www.cisecurity.org/ CIS: 1.7.1]
!f:/etc/mod;
!f:/etc/motd -> r:\\v|\\r|\\m|\\s|alma;

# 38046 Ensure local login warning banner is configured properly.
# The contents of the /etc/issue file are displayed to users prior to login for local terminals. Unix-...
[CIS - Alma Linux 10 - Ensure local login warning banner is configured properly. {CIS: 1.7.2}] [any] [https://www.cisecurity.org/ CIS: 1.7.2]
!f:/etc/issue;
!f:/etc/issue -> r:\\v|\\r|\\m|\\s|alma;

# 38047 Ensure remote login warning banner is configured properly.
# The contents of the /etc/issue.net file are displayed to users prior to login for remote connections...
[CIS - Alma Linux 10 - Ensure remote login warning banner is configured properly. {CIS: 1.7.3}] [any] [https://www.cisecurity.org/ CIS: 1.7.3]
!f:/etc/issue.net;
!f:/etc/issue.net -> r:\\v|\\r|\\m|\\s|alma;

# 38048 Ensure permissions on /etc/motd are configured.
# The contents of the /etc/motd file are displayed to users after login and function as a message of t...
[CIS - Alma Linux 10 - Ensure permissions on /etc/motd are configured. {CIS: 1.7.4} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 1.7.4]
c:stat -L /etc/motd -> r:Access:\s*\(0644/-rw-r--r--\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\);

# 38049 Ensure permissions on /etc/issue are configured.
# The contents of the /etc/issue file are displayed to users prior to login for local terminals.
[CIS - Alma Linux 10 - Ensure permissions on /etc/issue are configured. {CIS: 1.7.5} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 1.7.5]
c:stat -L /etc/issue -> r:Access:\s*\(0644/-rw-r--r--\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\);

# 38050 Ensure permissions on /etc/issue.net are configured.
# The contents of the /etc/issue.net file are displayed to users prior to login for remote connections...
[CIS - Alma Linux 10 - Ensure permissions on /etc/issue.net are configured. {CIS: 1.7.6} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 1.7.6]
c:stat -L /etc/issue.net -> r:Access:\s*\(0644/-rw-r--r--\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\);

# 38051 Ensure GNOME Display Manager is removed.
# The GNOME Display Manager (GDM) is a program that manages graphical display servers and handles grap...
[CIS - Alma Linux 10 - Ensure GNOME Display Manager is removed. {CIS: 1.8.1} {PCI_DSS: 1.1.6, 1.2.1}] [all] [https://www.cisecurity.org/ CIS: 1.8.1]
f:rpm -q gdm -> r:is not installed;

# 38052 Ensure GDM login banner is configured.
# GDM is the GNOME Display Manager which handles graphical login for GNOME based systems.
[CIS - Alma Linux 10 - Ensure GDM login banner is configured. {CIS: 1.8.2}] [all] [https://www.cisecurity.org/ CIS: 1.8.2]
f:/etc/dconf/profile/gdm;
f:/etc/dconf/profile/gdm -> r:user-db:user;
f:/etc/dconf/profile/gdm -> r:system-db:gdm;
f:/etc/dconf/profile/gdm -> r:file-db:/usr/share/gdm/greeter-dconf-defaults;
d:/etc/dconf/db/gdm.d -> r:.+ -> r:banner-message-enable=true;
d:/etc/dconf/db/gdm.d -> r:.+ -> r:banner-message-text=;

# 38053 Ensure GDM disable-user-list option is enabled.
# GDM is the GNOME Display Manager which handles graphical login for GNOME based systems. The disable-...
[CIS - Alma Linux 10 - Ensure GDM disable-user-list option is enabled. {CIS: 1.8.3}] [all] [https://www.cisecurity.org/ CIS: 1.8.3]
f:/etc/dconf/profile/gdm;
f:/etc/dconf/profile/gdm -> r:user-db:user;
f:/etc/dconf/profile/gdm -> r:system-db:gdm;
f:/etc/dconf/profile/gdm -> r:file-db:/usr/share/gdm/greeter-dconf-defaults;
d:/etc/dconf/db/gdm.d -> r:.+ -> r:banner-message-enable=true;
d:/etc/dconf/db/gdm.d -> r:.+ -> r:banner-message-text=;
d:/etc/dconf/db/gdm.d -> r:.+ -> r:disable-user-list=true;

# 38054 Ensure GDM screen locks when the user is idle.
# GNOME Desktop Manager can make the screen lock automatically whenever the user is idle for some amou...
[CIS - Alma Linux 10 - Ensure GDM screen locks when the user is idle. {CIS: 1.8.4} {PCI_DSS: 8.1.8}] [all] [https://www.cisecurity.org/ CIS: 1.8.4]
f:/etc/dconf/profile/gdm;
f:/etc/dconf/profile/gdm -> r:user-db:user;
f:/etc/dconf/profile/gdm -> r:system-db:gdm;
d:/etc/dconf/db/local.d -> r:.+ -> r:lock-delay=uint32;

# 38055 Ensure GDM automatic mounting of removable media is disabled.
# By default GNOME automatically mounts removable media when inserted as a convenience to the user.
[CIS - Alma Linux 10 - Ensure GDM automatic mounting of removable media is disabled. {CIS: 1.8.6}] [all] [https://www.cisecurity.org/ CIS: 1.8.6]
c:gsettings get org.gnome.desktop.media-handling automount -> r:^false;

# 38056 Ensure XDCMP is not enabled.
# X Display Manager Control Protocol (XDMCP) is designed to provide authenticated access to display ma...
[CIS - Alma Linux 10 - Ensure XDCMP is not enabled. {CIS: 1.8.10} {PCI_DSS: 1.1.6, 1.2.1}] [all] [https://www.cisecurity.org/ CIS: 1.8.10]
!f:/etc/gdm/custom.conf -> r:^\s*Enable\s*=\s*true;

# 38057 Ensure system-wide crypto policy is not legacy.
# The system-wide crypto-policies followed by the crypto core components allow consistently deprecatin...
[CIS - Alma Linux 10 - Ensure system-wide crypto policy is not legacy. {CIS: 1.10} {PCI_DSS: 2.1.1, 4.1}] [all] [https://www.cisecurity.org/ CIS: 1.10]
f:/etc/crypto-policies/config -> r:^\s*LEGACY;

# 38058 Ensure time synchronization is in use.
# System time should be synchronized between all systems in an environment. This is typically done by ...
[CIS - Alma Linux 10 - Ensure time synchronization is in use. {CIS: 2.1.1} {PCI_DSS: 10.4}] [all] [https://www.cisecurity.org/ CIS: 2.1.1]
c:rpm -q chrony -> r:^chrony-;

# 38059 Ensure chrony is configured.
# chrony is a daemon which implements the Network Time Protocol (NTP) and is designed to synchronize s...
[CIS - Alma Linux 10 - Ensure chrony is configured. {CIS: 2.1.2} {PCI_DSS: 10.4}] [all] [https://www.cisecurity.org/ CIS: 2.1.2]
f:/etc/chrony.conf;
f:/etc/chrony.conf -> r:^\s*\t*server|^\s*\t*pool;
f:/etc/sysconfig/chronyd -> r:^\s*\t*OPTIONS.*-u chrony;

# 38060 Ensure xorg-x11-server-common is not installed.
# The X Window System provides a Graphical User Interface (GUI) where users can have multiple windows ...
[CIS - Alma Linux 10 - Ensure xorg-x11-server-common is not installed. {CIS: 2.2.1} {PCI_DSS: 1.1.6, 1.2.1}] [all] [https://www.cisecurity.org/ CIS: 2.2.1]
c:rpm -q xorg-x11-server-common -> r:^package xorg-x11-server-common is not installed;

# 38061 Ensure Avahi Server is not installed.
# Avahi is a free zeroconf implementation, including a system for multicast DNS/DNS-SD service discove...
[CIS - Alma Linux 10 - Ensure Avahi Server is not installed. {CIS: 2.2.2} {PCI_DSS: 1.1.6, 1.2.1}] [all] [https://www.cisecurity.org/ CIS: 2.2.2]
c:rpm -q avahi -> r:^package avahi is not installed;

# 38062 Ensure CUPS is not installed.
# The Common Unix Print System (CUPS) provides the ability to print to both local and network printers...
[CIS - Alma Linux 10 - Ensure CUPS is not installed. {CIS: 2.2.3} {PCI_DSS: 1.1.6, 1.2.1}] [all] [https://www.cisecurity.org/ CIS: 2.2.3]
c:rpm -q cups -> r:^package cups is not installed;

# 38063 Ensure DHCP Server is not installed.
# The Dynamic Host Configuration Protocol (DHCP) is a service that allows machines to be dynamically a...
[CIS - Alma Linux 10 - Ensure DHCP Server is not installed. {CIS: 2.2.4} {PCI_DSS: 1.1.6, 1.2.1}] [all] [https://www.cisecurity.org/ CIS: 2.2.4]
c:rpm -q dhcp-server -> r:^package dhcp-server is not installed;

# 38064 Ensure DNS Server is not installed.
# The Domain Name System (DNS) is a hierarchical naming system that maps names to IP addresses for com...
[CIS - Alma Linux 10 - Ensure DNS Server is not installed. {CIS: 2.2.5} {PCI_DSS: 1.1.6, 1.2.1}] [all] [https://www.cisecurity.org/ CIS: 2.2.5]
c:rpm -q bind -> r:^package bind is not installed;

# 38065 Ensure VSFTP Server is not installed.
# FTP (File Transfer Protocol) is a traditional and widely used standard tool for transferring files b...
[CIS - Alma Linux 10 - Ensure VSFTP Server is not installed. {CIS: 2.2.6} {PCI_DSS: 1.1.6, 1.2.1}] [all] [https://www.cisecurity.org/ CIS: 2.2.6]
c:rpm -q vsftpd -> r:^package vsftpd is not installed;

# 38066 Ensure TFTP Server is not installed.
# Trivial File Transfer Protocol (TFTP) is a simple protocol for exchanging files between two TCP/IP m...
[CIS - Alma Linux 10 - Ensure TFTP Server is not installed. {CIS: 2.2.7} {PCI_DSS: 1.1.6, 1.2.1}] [all] [https://www.cisecurity.org/ CIS: 2.2.7]
c:rpm -q tftp-server -> r:^package tftp-server is not installed;

# 38067 Ensure a web server is not installed.
# Web servers provide the ability to host web site content.
[CIS - Alma Linux 10 - Ensure a web server is not installed. {CIS: 2.2.8} {PCI_DSS: 1.1.6, 1.2.1}] [all] [https://www.cisecurity.org/ CIS: 2.2.8]
c:rpm -q nginx -> r:^package nginx is not installed;
c:rpm -q httpd -> r:^package httpd is not installed;

# 38068 Ensure IMAP and POP3 server is not installed.
# dovecot is an open source IMAP and POP3 server for Linux based systems.
[CIS - Alma Linux 10 - Ensure IMAP and POP3 server is not installed. {CIS: 2.2.9} {PCI_DSS: 1.1.6, 1.2.1}] [all] [https://www.cisecurity.org/ CIS: 2.2.9]
c:rpm -q dovecot -> r:^package dovecot is not installed;
c:rpm -q cyrus-imapd -> r:^package cyrus-imapd is not installed;

# 38069 Ensure Samba is not installed.
# The Samba daemon allows system administrators to configure their Linux systems to share file systems...
[CIS - Alma Linux 10 - Ensure Samba is not installed. {CIS: 2.2.10} {PCI_DSS: 1.1.6, 1.2.1}] [all] [https://www.cisecurity.org/ CIS: 2.2.10]
c:rpm -q samba -> r:^package samba is not installed;

# 38070 Ensure HTTP Proxy Server is not installed.
# Squid is a standard proxy server used in many distributions and environments.
[CIS - Alma Linux 10 - Ensure HTTP Proxy Server is not installed. {CIS: 2.2.11} {PCI_DSS: 1.1.6, 1.2.1}] [all] [https://www.cisecurity.org/ CIS: 2.2.11]
c:rpm -q squid -> r:^package squid is not installed;

# 38071 Ensure net-snmp is not installed.
# Simple Network Management Protocol (SNMP) is a widely used protocol for monitoring the health and we...
[CIS - Alma Linux 10 - Ensure net-snmp is not installed. {CIS: 2.2.12} {PCI_DSS: 1.1.6, 1.2.1}] [all] [https://www.cisecurity.org/ CIS: 2.2.12]
c:rpm -q net-snmp -> r:^package net-snmp is not installed;

# 38072 Ensure telnet-server is not installed.
# The telnet-server package contains the telnet daemon, which accepts connections from users from othe...
[CIS - Alma Linux 10 - Ensure telnet-server is not installed. {CIS: 2.2.13} {PCI_DSS: 1.1.6, 1.2.1}] [all] [https://www.cisecurity.org/ CIS: 2.2.13]
c:rpm -q telnet-server -> r:^package telnet-server is not installed;

# 38073 Ensure dnsmasq is not installed.
# dnsmasq is a lightweight tool that provides DNS caching, DNS forwarding and DHCP (Dynamic Host Confi...
[CIS - Alma Linux 10 - Ensure dnsmasq is not installed. {CIS: 2.2.14}] [all] [https://www.cisecurity.org/ CIS: 2.2.14]
c:rpm -q dnsmasq -> r:^package dnsmasq is not installed;

# 38074 Ensure mail transfer agent is configured for local-only mode.
# Mail Transfer Agents (MTA), such as sendmail and Postfix, are used to listen for incoming mail and t...
[CIS - Alma Linux 10 - Ensure mail transfer agent is configured for local-only mode. {CIS: 2.2.15} {PCI_DSS: 1.1.6, 1.2.1}] [all] [https://www.cisecurity.org/ CIS: 2.2.15]
!c:ss -lntu -> r:\s*127\.0\.0\.1:25\s*|\s*::1:25\s*;

# 38075 Ensure nfs-utils is not installed or the nfs-server service is masked.
# The Network File System (NFS) is one of the first and most widely distributed file systems in the UN...
[CIS - Alma Linux 10 - Ensure nfs-utils is not installed or the nfs-server service is masked. {CIS: 2.2.16} {PCI_DSS: 1.1.6, 1.2.1}] [any] [https://www.cisecurity.org/ CIS: 2.2.16]
c:rpm -q nfs-utils -> r:^package nfs-utils is not installed;
c:systemctl is-enabled nfs-server -> r:masked|No such file or directory;

# 38076 Ensure rpcbind is not installed or the rpcbind services are masked.
# The rpcbind utility maps RPC services to the ports on which they listen. RPC processes notify rpcbin...
[CIS - Alma Linux 10 - Ensure rpcbind is not installed or the rpcbind services are masked. {CIS: 2.2.17} {PCI_DSS: 1.1.6, 1.2.1}] [any] [https://www.cisecurity.org/ CIS: 2.2.17]
c:rpm -q rpcbind -> r:^package rpcbind is not installed;
c:systemctl is-enabled rpcbind -> r:masked|No such file or directory;
c:systemctl is-enabled rpcbind.socket -> r:masked|No such file or directory;

# 38077 Ensure rsync-daemon is not installed or the rsyncd service is masked.
# The rsyncd service can be used to synchronize files between systems over network links.
[CIS - Alma Linux 10 - Ensure rsync-daemon is not installed or the rsyncd service is masked. {CIS: 2.2.18} {PCI_DSS: 1.1.6, 1.2.1}] [any] [https://www.cisecurity.org/ CIS: 2.2.18]
c:rpm -q rsync-daemon -> r:^package rsync-daemon is not installed;
c:systemctl is-enabled rsyncd -> r:masked|No such file or directory;

# 38078 Ensure telnet client is not installed.
# The telnet package contains the telnet client, which allows users to start connections to other syst...
[CIS - Alma Linux 10 - Ensure telnet client is not installed. {CIS: 2.3.1} {PCI_DSS: 1.1.6, 1.2.1}] [all] [https://www.cisecurity.org/ CIS: 2.3.1]
c:rpm -q telnet -> r:^package telnet is not installed;

# 38079 Ensure LDAP client is not installed.
# The Lightweight Directory Access Protocol (LDAP) was introduced as a replacement for NIS/YP. It is a...
[CIS - Alma Linux 10 - Ensure LDAP client is not installed. {CIS: 2.3.2} {PCI_DSS: 1.1.6, 1.2.1}] [all] [https://www.cisecurity.org/ CIS: 2.3.2]
c:rpm -q openldap-clients -> r:^package openldap-clients is not installed;

# 38080 Ensure TFTP client is not installed.
# Trivial File Transfer Protocol (TFTP) is a simple protocol for exchanging files between two TCP/IP m...
[CIS - Alma Linux 10 - Ensure TFTP client is not installed. {CIS: 2.3.3} {PCI_DSS: 1.1.6, 1.2.1}] [all] [https://www.cisecurity.org/ CIS: 2.3.3]
c:rpm -q tftp -> r:^package tftp is not installed;

# 38081 Ensure FTP client is not installed.
# FTP (File Transfer Protocol) is a traditional and widely used standard tool for transferring files b...
[CIS - Alma Linux 10 - Ensure FTP client is not installed. {CIS: 2.3.4} {PCI_DSS: 1.1.6, 1.2.1}] [all] [https://www.cisecurity.org/ CIS: 2.3.4]
c:rpm -q ftp -> r:^package ftp is not installed;

# 38082 Ensure TIPC is disabled.
# The Transparent Inter-Process Communication (TIPC) protocol is designed to provide communication bet...
[CIS - Alma Linux 10 - Ensure TIPC is disabled. {CIS: 3.1.3}] [all] [https://www.cisecurity.org/ CIS: 3.1.3]
c:modprobe -n -v tipc -> r:^install\s*\t*/bin/true;
!c:lsmod -> r:^tipc;

# 38083 Ensure nftables is installed.
# nftables provides a new in-kernel packet classification framework that is based on a network-specifi...
[CIS - Alma Linux 10 - Ensure nftables is installed. {CIS: 3.4.1.1} {PCI_DSS: 1.1.4, 1.3.1}] [all] [https://www.cisecurity.org/ CIS: 3.4.1.1]
c:rpm -q nftables -> r:^nftables-;

# 38084 Ensure a single firewall configuration utility is in use.
# FirewallD - Is a firewall service daemon that provides a dynamic customizable host-based firewall wi...
[CIS - Alma Linux 10 - Ensure a single firewall configuration utility is in use. {CIS: 3.4.1.2} {PCI_DSS: 1.1.4, 1.3.1}] [any] [https://www.cisecurity.org/ CIS: 3.4.1.2]
c:rpm -q firewalld -> r:^package firewalld is not installed;
!c:firewall-cmd --state -> r:^running;
c:systemctl is-enabled firewalld -> r:^masked;

# 38085 Ensure at least one nftables table exists.
# Tables hold chains. Each table only has one address family and only applies to packets of this famil...
[CIS - Alma Linux 10 - Ensure at least one nftables table exists. {CIS: 3.4.2.2} {PCI_DSS: 1.1.4, 1.3.1}] [all] [https://www.cisecurity.org/ CIS: 3.4.2.2]
c:nft list tables -> r:^table;

# 38086 Ensure nftables base chains exist.
# Chains are containers for rules. They exist in two kinds, base chains and regular chains. A base cha...
[CIS - Alma Linux 10 - Ensure nftables base chains exist. {CIS: 3.4.2.3} {PCI_DSS: 1.1.4, 1.3.1}] [all] [https://www.cisecurity.org/ CIS: 3.4.2.3]
c:rpm -q nftables -> r:nftables-;
c:nft list ruleset -> r:hook input;
c:nft list ruleset -> r:hook forward;
c:nft list ruleset -> r:hook output;

# 38087 Ensure nftables default deny firewall policy.
# Base chain policy is the default verdict that will be applied to packets reaching the end of the cha...
[CIS - Alma Linux 10 - Ensure nftables default deny firewall policy. {CIS: 3.4.2.7} {PCI_DSS: 1.1.4, 1.3.1}] [all] [https://www.cisecurity.org/ CIS: 3.4.2.7]
c:nft list ruleset -> r:hook input && r:policy drop;
c:nft list ruleset -> r:hook forward && r:policy drop;
c:nft list ruleset -> r:hook output && r:policy drop;

# 38088 Ensure auditd is installed.
# auditd is the userspace component to the Linux Auditing System. It's responsible for writing audit r...
[CIS - Alma Linux 10 - Ensure auditd is installed. {CIS: 4.1.1.1} {PCI_DSS: 10.1, 10.2}] [all] [https://www.cisecurity.org/ CIS: 4.1.1.1]
c:rpm -q audit -> r:^audit-;

# 38089 Ensure auditing for processes that start prior to auditd is enabled.
# Configure grub2 so that processes that are capable of being audited can be audited even if they star...
[CIS - Alma Linux 10 - Ensure auditing for processes that start prior to auditd is enabled. {CIS: 4.1.1.2} {PCI_DSS: 10.2, 10.3}] [all] [https://www.cisecurity.org/ CIS: 4.1.1.2]
c:grubby --info=ALL -> r:audit=1;

# 38090 Ensure audit_backlog_limit is sufficient.
# The backlog limit has a default setting of 64.
[CIS - Alma Linux 10 - Ensure audit_backlog_limit is sufficient. {CIS: 4.1.1.3} {PCI_DSS: 10.2, 10.3}] [all] [https://www.cisecurity.org/ CIS: 4.1.1.3]
c:grubby --info=ALL -> n:\s*audit_backlog_limit=(\d+) compare >= 8192;

# 38091 Ensure auditd service is enabled.
# Turn on the auditd daemon to record system events.
[CIS - Alma Linux 10 - Ensure auditd service is enabled. {CIS: 4.1.1.4} {PCI_DSS: 10.2, 10.3}] [all] [https://www.cisecurity.org/ CIS: 4.1.1.4]
c:systemctl is-enabled auditd -> r:^enabled;

# 38092 Ensure audit log storage size is configured.
# Configure the maximum size of the audit log file. Once the log reaches the maximum size, it will be ...
[CIS - Alma Linux 10 - Ensure audit log storage size is configured. {CIS: 4.1.2.1} {PCI_DSS: 10.7}] [all] [https://www.cisecurity.org/ CIS: 4.1.2.1]
f:/etc/audit/auditd.conf -> r:^\s*max_log_file\s*=;

# 38093 Ensure audit logs are not automatically deleted.
# The max_log_file_action setting determines how to handle the audit log file reaching the max file si...
[CIS - Alma Linux 10 - Ensure audit logs are not automatically deleted. {CIS: 4.1.2.2} {PCI_DSS: 10.7}] [all] [https://www.cisecurity.org/ CIS: 4.1.2.2]
f:/etc/audit/auditd.conf -> r:^\s*max_log_file_action\s*=\s*keep_logs;

# 38094 Ensure system is disabled when audit logs are full.
# The auditd daemon can be configured to halt the system when the audit logs are full. The admin_space...
[CIS - Alma Linux 10 - Ensure system is disabled when audit logs are full. {CIS: 4.1.2.3} {PCI_DSS: 10.2, 10.3}] [all] [https://www.cisecurity.org/ CIS: 4.1.2.3]
f:/etc/audit/auditd.conf -> r:^\s*space_left_action\s*=\s*email;
f:/etc/audit/auditd.conf -> r:^\s*action_mail_acct\s*=\s*root;
f:/etc/audit/auditd.conf -> r:^\s*admin_space_left_action\s*=\s*halt|^\s*admin_space_left_action\s*=\s*single;

# 38095 Ensure changes to system administration scope (sudoers) is collected.
# Monitor scope changes for system administrators. If the system has been properly configured to force...
[CIS - Alma Linux 10 - Ensure changes to system administration scope (sudoers) is collected. {CIS: 4.1.3.1} {PCI_DSS: 10.1, 10.2.2}] [all] [https://www.cisecurity.org/ CIS: 4.1.3.1]
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-w && r:/etc/sudoers && r:-p wa && r:-k scope|key=\\s*\t*scope;
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-w && r:/etc/sudoers\.d && r:-p wa && r:-k scope|key=\\s*\t*scope;
c:auditctl -l -> r:^-w && r:/etc/sudoers && r:-p wa && r:-k scope|key=\\s*\t*scope;
c:auditctl -l -> r:^-w && r:/etc/sudoers\.d && r:-p wa && r:-k scope|key=\\s*\t*scope;

# 38096 Ensure actions as another user are always logged.
# sudo provides users with temporary elevated privileges to perform operations, either as the superuse...
[CIS - Alma Linux 10 - Ensure actions as another user are always logged. {CIS: 4.1.3.2} {PCI_DSS: 10.1, 10.2.2}] [all] [https://www.cisecurity.org/ CIS: 4.1.3.2]
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-a && r:exit,always|always,exit && r:-F arch=b64 && r:-C euid!=uid|-C uid!=euid  && r:-F auid!=unset|-F auid!=1|-F auid!=4294967295 && r:-S execve && r:-k user_emulation|key=user_emulation;
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-a && r:exit,always|always,exit && r:-F arch=b32 && r:-C euid!=uid|-C uid!=euid  && r:-F auid!=unset|-F auid!=1|-F auid!=4294967295 && r:-S execve && r:-k user_emulation|key=user_emulation;
c:auditctl -l -> r:^-a && r:exit,always|always,exit && r:-F arch=b64 && r:-C euid!=uid|-C uid!=euid && r:-F auid!=unset|-F auid!=1|-F auid!=4294967295 && r:-S execve && r:-k user_emulation|key=user_emulation;
c:auditctl -l -> r:^-a && r:exit,always|always,exit && r:-F arch=b32 && r:-C euid!=uid|-C uid!=euid && r:-F auid!=unset|-F auid!=1|-F auid!=4294967295 && r:-S execve && r:-k user_emulation|key=user_emulation;

# 38097 Ensure events that modify date and time information are collected.
# Capture events where the system date and/or time has been modified. The parameters in this section a...
[CIS - Alma Linux 10 - Ensure events that modify date and time information are collected. {CIS: 4.1.3.4} {PCI_DSS: 10.1, 10.2.2}] [all] [https://www.cisecurity.org/ CIS: 4.1.3.4]
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-a && r:always,exit|exit,always && r:-F arch=b64 && r:-S && r:adjtimex && r:settimeofday && r:clock_settime && r:-k time-change|key=time-change;
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-a && r:always,exit|exit,always && r:-F arch=b32 && r:-S && r:adjtimex && r:settimeofday && r:clock_settime && r:-k time-change|key=time-change;
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-w && r:/etc/localtime && r:-p wa && r:-k time-change|key=time-change;
c:auditctl -l -> r:^-a && r:always,exit|exit,always && r:-F arch=b64 && r:-S && r:adjtimex && r:settimeofday && r:clock_settime && r:-k time-change|key=time-change;
c:auditctl -l -> r:^-a && r:always,exit|exit,always && r:-F arch=b32 && r:-S && r:adjtimex && r:settimeofday && r:clock_settime && r:-k time-change|key=time-change;
c:auditctl -l -> r:^-w && r:/etc/localtime && r:-p wa && r:-k time-change|key=time-change;

# 38098 Ensure events that modify the system's network environment are collected.
# Record changes to network environment files or system calls. The below parameters monitors the follo...
[CIS - Alma Linux 10 - Ensure events that modify the system's network environment are collected. {CIS: 4.1.3.5} {PCI_DSS: 10.1, 10.2.2}] [all] [https://www.cisecurity.org/ CIS: 4.1.3.5]
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-a && r:exit,always|always,exit && r:-F arch=b32 && r:-S && r:sethostname && r:setdomainname && r:-k system-locale|key=system-locale;
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-a && r:exit,always|always,exit && r:-F arch=b64 && r:-S && r:sethostname && r:setdomainname && r:-k system-locale|key=system-locale;
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-w && r:/etc/issue && r:-p wa && r:-k system-locale|key=system-locale;
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-w && r:/etc/issue\.net && r:-p wa && r:-k system-locale|key=system-locale;
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-w && r:/etc/hosts && r:-p wa && r:-k system-locale|key=system-locale;
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-w && r:/etc/sysconfig/network && r:-p wa && r:-k system-locale|key=system-locale;
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-w && r:/etc/sysconfig/network-scripts && r:-p wa && r:-k system-locale|key=system-locale;
c:auditctl -l -> r:^-a && r:exit,always|always,exit && r:-F arch=b64 && r:-S && r:sethostname && r:setdomainname && r:-k system-locale|-F key=system-locale;
c:auditctl -l -> r:^-a && r:exit,always|always,exit && r:-F arch=b32 && r:-S && r:sethostname && r:setdomainname && r:-k system-locale|-F key=system-locale;
c:auditctl -l -> r:^-w && r:/etc/issue && r:-p wa && r:-k system-locale|key=system-locale;
c:auditctl -l -> r:^-w && r:/etc/issue\.net && r:-p wa && r:-k system-locale|key=system-locale;
c:auditctl -l -> r:^-w && r:/etc/hosts && r:-p wa && r:-k system-locale|key=system-locale;
c:auditctl -l -> r:^-w && r:/etc/sysconfig/network && r:-p wa && r:-k system-locale|key=system-locale;
c:auditctl -l -> r:^-w && r:/etc/sysconfig/network-scripts && r:-p wa && r:-k system-locale|key=system-locale;

# 38099 Ensure events that modify user/group information are collected.
# Record events affecting the modification of user or group information, including that of passwords a...
[CIS - Alma Linux 10 - Ensure events that modify user/group information are collected. {CIS: 4.1.3.8} {PCI_DSS: 10.1, 10.2.2}] [all] [https://www.cisecurity.org/ CIS: 4.1.3.8]
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-w && r:/etc/group && r:-p wa && r:-k identity|key=identity;
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-w && r:/etc/passwd && r:-p wa && r:-k identity|key=identity;
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-w && r:/etc/gshadow && r:-p wa && r:-k identity|key=identity;
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-w && r:/etc/shadow && r:-p wa && r:-k identity|key=identity;
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-w && r:/etc/security/opasswd && r:-p wa && r:-k identity|key=identity;
c:auditctl -l -> r:^-w && r:/etc/group && r:-p wa && r:-k identity|key=identity;
c:auditctl -l -> r:^-w && r:/etc/passwd && r:-p wa && r:-k identity|key=identity;
c:auditctl -l -> r:^-w && r:/etc/gshadow && r:-p wa && r:-k identity|key=identity;
c:auditctl -l -> r:^-w && r:/etc/shadow && r:-p wa && r:-k identity|key=identity;
c:auditctl -l -> r:^-w && r:/etc/security/opasswd && r:-p wa && r:-k identity|key=identity;

# 38100 Ensure successful file system mounts are collected.
# Monitor the use of the mount system call. The mount (and umount) system call controls the mounting a...
[CIS - Alma Linux 10 - Ensure successful file system mounts are collected. {CIS: 4.1.3.10} {PCI_DSS: 10.1, 10.2.2}] [all] [https://www.cisecurity.org/ CIS: 4.1.3.10]
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-a && r:always,exit|exit,always && r:-F arch=b32 && r:-S mount && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k mounts|key=mounts;
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-a && r:always,exit|exit,always && r:-F arch=b64 && r:-S mount && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k mounts|key=mounts;
c:auditctl -l -> r:^-a && r:always,exit|exit,always && r:-F arch=b64 && r:-S mount && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k mounts|key=mounts;
c:auditctl -l -> r:^-a && r:always,exit|exit,always && r:-F arch=b32 && r:-S mount && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k mounts|key=mounts;

# 38101 Ensure session initiation information is collected.
# Monitor session initiation events. The parameters in this section track changes to the files associa...
[CIS - Alma Linux 10 - Ensure session initiation information is collected. {CIS: 4.1.3.11} {PCI_DSS: 10.1, 10.2.2}] [all] [https://www.cisecurity.org/ CIS: 4.1.3.11]
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-w && r:/var/run/utmp && r:-p wa && r:-k session|key=session;
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-w && r:/var/log/wtmp && r:-p wa && r:-k session|key=session;
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-w && r:/var/log/btmp && r:-p wa && r:-k session|key=session;
c:auditctl -l -> r:^-w && r:/var/run/utmp && r:-p wa && r:-k session|key=session;
c:auditctl -l -> r:^-w && r:/var/log/wtmp && r:-p wa && r:-k session|key=session;
c:auditctl -l -> r:^-w && r:/var/log/btmp && r:-p wa && r:-k session|key=session;

# 38102 Ensure login and logout events are collected.
# Monitor login and logout events. The parameters below track changes to files associated with login/l...
[CIS - Alma Linux 10 - Ensure login and logout events are collected. {CIS: 4.1.3.12} {PCI_DSS: 10.1, 10.2.2}] [all] [https://www.cisecurity.org/ CIS: 4.1.3.12]
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-w && r:/var/log/lastlog && r:-p wa && r:-k logins|key=logins;
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-w && r:/var/run/faillock && r:-p wa && r:-k logins|key=logins;
c:auditctl -l -> r:^-w && r:/var/log/lastlog && r:-p wa && r:-k logins|key=logins;
c:auditctl -l -> r:^-w && r:/var/run/faillock && r:-p wa && r:-k logins|key=logins;

# 38103 Ensure file deletion events by users are collected.
# Monitor the use of system calls associated with the deletion or renaming of files and file attribute...
[CIS - Alma Linux 10 - Ensure file deletion events by users are collected. {CIS: 4.1.3.13} {PCI_DSS: 10.1, 10.2.2}] [all] [https://www.cisecurity.org/ CIS: 4.1.3.13]
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-a && r:always,exit|exit,always && r:-F arch=b64 && r:-S && r:unlink && r:unlinkat && r:rename && r:renameat && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k delete|key=delete;
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-a && r:always,exit|exit,always && r:-F arch=b32 && r:-S && r:unlink && r:unlinkat && r:rename && r:renameat && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k delete|key=delete;
c:auditctl -l -> r:^-a && r:always,exit|exit,always && r:-F arch=b64 && r:-S && r:unlink && r:unlinkat && r:rename && r:renameat && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k delete|key=delete;
c:auditctl -l -> r:^-a && r:always,exit|exit,always && r:-F arch=b32 && r:-S && r:unlink && r:unlinkat && r:rename && r:renameat && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k delete|key=delete;

# 38104 Ensure events that modify the system's Mandatory Access Controls are collected.
# Monitor SELinux, an implementation of mandatory access controls. The parameters below monitor any wr...
[CIS - Alma Linux 10 - Ensure events that modify the system's Mandatory Access Controls are collected. {CIS: 4.1.3.14} {PCI_DSS: 10.1, 10.2.2}] [all] [https://www.cisecurity.org/ CIS: 4.1.3.14]
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-w && r:/etc/selinux && r:-p wa && r:-k MAC-policy|key=MAC-policy;
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-w && r:/usr/share/selinux && r:-p wa && r:-k MAC-policy|key=MAC-policy;
c:auditctl -l -> r:^-w && r:/etc/selinux && r:-p wa && r:-k MAC-policy|key=MAC-policy;
c:auditctl -l -> r:^-w && r:/usr/share/selinux && r:-p wa && r:-k MAC-policy|key=MAC-policy;

# 38105 Ensure successful and unsuccessful attempts to use the chcon command are recorded.
# The operating system must generate audit records for successful/unsuccessful uses of the chcon comma...
[CIS - Alma Linux 10 - Ensure successful and unsuccessful attempts to use the chcon command are recorded. {CIS: 4.1.3.15} {PCI_DSS: 10.2, 10.3}] [all] [https://www.cisecurity.org/ CIS: 4.1.3.15]
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-a && r:always,exit|exit,always && r:-F path=/usr/bin/chcon && r:-F perm=x && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k perm_chng|key=perm_chng;
c:auditctl -l -> r:^-a && r:always,exit|exit,always && r:-F path=/usr/bin/chcon && r:-F perm=x && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k perm_chng|key=perm_chng;

# 38106 Ensure successful and unsuccessful attempts to use the setfacl command are recorded.
# The operating system must generate audit records for successful/unsuccessful uses of the setfacl com...
[CIS - Alma Linux 10 - Ensure successful and unsuccessful attempts to use the setfacl command are recorded. {CIS: 4.1.3.16} {PCI_DSS: 10.2, 10.3}] [all] [https://www.cisecurity.org/ CIS: 4.1.3.16]
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-a && r:always,exit|exit,always && r:-F path=/usr/bin/setfacl && r:-F perm=x && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k perm_chng|-F key=perm_chng;
c:auditctl -l -> r:^-a && r:always,exit|exit,always && r:-F path=/usr/bin/setfacl && r:-F perm=x && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k perm_chng|-F key=perm_chng;

# 38107 Ensure successful and unsuccessful attempts to use the chacl command are recorded.
# The operating system must generate audit records for successful/unsuccessful uses of the chacl comma...
[CIS - Alma Linux 10 - Ensure successful and unsuccessful attempts to use the chacl command are recorded. {CIS: 4.1.3.17} {PCI_DSS: 10.2, 10.3}] [all] [https://www.cisecurity.org/ CIS: 4.1.3.17]
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-a && r:always,exit|exit,always && r:-F path=/usr/bin/chacl && r:-F perm=x && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k priv_cmd|-F key=priv_cmd;
c:auditctl -l -> r:^-a && r:always,exit|exit,always && r:-F path=/usr/bin/chacl && r:-F perm=x && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k priv_cmd|-F key=priv_cmd;

# 38108 Ensure successful and unsuccessful attempts to use the usermod command are recorded.
# The operating system must generate audit records for successful/unsuccessful uses of the usermod com...
[CIS - Alma Linux 10 - Ensure successful and unsuccessful attempts to use the usermod command are recorded. {CIS: 4.1.3.18} {PCI_DSS: 10.2, 10.3}] [all] [https://www.cisecurity.org/ CIS: 4.1.3.18]
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-a && r:always,exit|exit,always && r:-F path=/usr/sbin/usermod && r:-F perm=x && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k usermod|-F key=usermod;
c:auditctl -l -> r:^-a && r:always,exit|exit,always && r:-F path=/usr/sbin/usermod && r:-F perm=x && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k usermod|-F key=usermod;

# 38109 Ensure kernel module loading unloading and modification is collected.
# Monitor the loading and unloading of kernel modules. All the loading / listing / dependency checking...
[CIS - Alma Linux 10 - Ensure kernel module loading unloading and modification is collected. {CIS: 4.1.3.19} {PCI_DSS: 10.1, 10.2.2}] [all] [https://www.cisecurity.org/ CIS: 4.1.3.19]
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-a && r:always,exit|exit,always && r:-F arch=b64|-F arch=b32 && r:-S && r:init_module && r:finit_module && r:delete_module && r:create_module && r:query_module && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k kernel_modules|-F key=kernel_modules;
d:/etc/audit/rules.d -> r:.+\.rules$ -> r:^-a && r:always,exit|exit,always && r:-F path=/usr/bin/kmod && r:-F perm=x && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k kernel_modules|-F key=kernel_modules;
c:auditctl -l -> r:^-a && r:always,exit|exit,always && r:-F arch=b64|-F arch=b32 && r:-S && r:init_module && r:finit_module && r:delete_module && r:create_module && r:query_module && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k kernel_modules|-F key=kernel_modules;
c:auditctl -l-> r:^-a && r:always,exit|exit,always && r:-F path=/usr/bin/kmod && r:-F perm=x && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k kernel_modules|-F key=kernel_modules;
c:ls -l /usr/sbin/lsmod -> r:/bin/kmod;
c:ls -l /usr/sbin/rmmod -> r:/bin/kmod;
c:ls -l /usr/sbin/insmod -> r:/bin/kmod;
c:ls -l /usr/sbin/modinfo -> r:/bin/kmod;
c:ls -l /usr/sbin/modprobe -> r:/bin/kmod;
c:ls -l /usr/sbin/depmod -> r:/bin/kmod;

# 38110 Ensure the audit configuration is immutable.
# Set system audit so that audit rules cannot be modified with auditctl. Setting the flag "-e 2" force...
[CIS - Alma Linux 10 - Ensure the audit configuration is immutable. {CIS: 4.1.3.20} {PCI_DSS: 10.1, 10.2.2}] [all] [https://www.cisecurity.org/ CIS: 4.1.3.20]
!d:/etc/audit/rules.d -> r:.+\.rules$ -> !r:\s*\t*-e 2$;

# 38111 Ensure the running and on disk configuration is the same.
# The Audit system have both on disk and running configuration. It is possible for these configuration...
[CIS - Alma Linux 10 - Ensure the running and on disk configuration is the same. {CIS: 4.1.3.21} {PCI_DSS: 10.1, 10.2.2}] [all] [https://www.cisecurity.org/ CIS: 4.1.3.21]
c:augenrules --check -> r:/usr/sbin/augenrules && r:No change;

# 38112 Ensure only authorized groups are assigned ownership of audit log files.
# Audit log files contain information about the system and system activity.
[CIS - Alma Linux 10 - Ensure only authorized groups are assigned ownership of audit log files. {CIS: 4.1.4.3} {PCI_DSS: 7.1, 7.1.1}] [any] [https://www.cisecurity.org/ CIS: 4.1.4.3]
f:/etc/audit/auditd.conf -> r:log_group\s*\t*= && !r:adm|root;

# 38113 Ensure audit configuration files are 640 or more restrictive.
# Audit configuration files control auditd and what events are audited.
[CIS - Alma Linux 10 - Ensure audit configuration files are 640 or more restrictive. {CIS: 4.1.4.5} {PCI_DSS: 7.1, 7.1.1}] [any] [https://www.cisecurity.org/ CIS: 4.1.4.5]
c:find /etc/audit/ -type f \( -name '*.conf' -o -name '*.rules' \) -exec stat -Lc "%n %a" {} + -> r:[\w@-]+ -> !r:000|040|200|400|600|240|440|640;

# 38114 Ensure audit configuration files are owned by root.
# Audit configuration files control auditd and what events are audited.
[CIS - Alma Linux 10 - Ensure audit configuration files are owned by root. {CIS: 4.1.4.6} {PCI_DSS: 7.1, 7.1.1}] [any] [https://www.cisecurity.org/ CIS: 4.1.4.6]
c:find /etc/audit/ -type f \( -name '*.rules' -o -name '*.conf' \) -exec stat -Lc "%U" {} + -> !r:root|\s*;

# 38115 Ensure audit configuration files belong to group root.
# Audit configuration files control auditd and what events are audited.
[CIS - Alma Linux 10 - Ensure audit configuration files belong to group root. {CIS: 4.1.4.7} {PCI_DSS: 7.1, 7.1.1}] [any] [https://www.cisecurity.org/ CIS: 4.1.4.7]
c:find /etc/audit/ -type f \( -name '*.conf' -o -name '*.rules' \) -exec stat -Lc "%U" {} + -> !r:root|\s*;

# 38116 Ensure audit tools are 755 or more restrictive.
# Audit tools include, but are not limited to, vendor-provided and open source audit tools needed to s...
[CIS - Alma Linux 10 - Ensure audit tools are 755 or more restrictive. {CIS: 4.1.4.8} {PCI_DSS: 7.1, 7.1.1}] [any] [https://www.cisecurity.org/ CIS: 4.1.4.8]
c:stat -c "%n %a" /sbin/auditctl /sbin/aureport /sbin/ausearch /sbin/autrace /sbin/auditd /sbin/augenrules -> r:[\w@-]+ && !r:000|010|040|050|001|011|041|051|004|014|044|054|005|015|045|055|700|710|740|750|701|711|741|751|704|714|744|754|705|715|745|755;

# 38117 Ensure audit tools are owned by root.
# Audit tools include, but are not limited to, vendor-provided and open source audit tools needed to s...
[CIS - Alma Linux 10 - Ensure audit tools are owned by root. {CIS: 4.1.4.9} {PCI_DSS: 7.1, 7.1.1}] [any] [https://www.cisecurity.org/ CIS: 4.1.4.9]
c:stat -c "%n %U" /sbin/auditctl /sbin/aureport /sbin/ausearch /sbin/autrace /sbin/auditd /sbin/augenrules -> !r:root|\\s*;

# 38118 Ensure audit tools belong to group root.
# Audit tools include, but are not limited to, vendor-provided and open source audit tools needed to s...
[CIS - Alma Linux 10 - Ensure audit tools belong to group root. {CIS: 4.1.4.10} {PCI_DSS: 7.1, 7.1.1}] [any] [https://www.cisecurity.org/ CIS: 4.1.4.10]
c:stat -c "%n %a %U %G" /sbin/auditctl /sbin/aureport /sbin/ausearch /sbin/autrace /sbin/auditd /sbin/augenrules -> !r:000|010|040|050|001|011|041|051|004|014|044|054|005|015|045|055|700|710|740|750|701|711|741|751|704|714|744|754|705|715|745|755 && r:\s*\t*root\s*\t*root;

# 38119 Ensure rsyslog is installed.
# The rsyslog software is recommended in environments where journald does not meet operation requireme...
[CIS - Alma Linux 10 - Ensure rsyslog is installed. {CIS: 4.2.1.1} {PCI_DSS: 10.2, 10.3}] [all] [https://www.cisecurity.org/ CIS: 4.2.1.1]
c:rpm -q rsyslog -> r:^rsyslog-;

# 38120 Ensure rsyslog service is enabled.
# Once the rsyslog package is installed, ensure that the service is enabled.
[CIS - Alma Linux 10 - Ensure rsyslog service is enabled. {CIS: 4.2.1.2} {PCI_DSS: 10.2, 10.3}] [all] [https://www.cisecurity.org/ CIS: 4.2.1.2]
c:systemctl is-enabled rsyslog -> r:^enabled;

# 38121 Ensure journald is configured to send logs to rsyslog.
# Data from journald may be stored in volatile memory or persisted locally on the server. Utilities ex...
[CIS - Alma Linux 10 - Ensure journald is configured to send logs to rsyslog. {CIS: 4.2.1.3} {PCI_DSS: 10.2, 10.3}] [all] [https://www.cisecurity.org/ CIS: 4.2.1.3]
f:/etc/systemd/journald.conf -> r:^\s*\t*ForwardToSyslog\s*=\s*yes;

# 38122 Ensure rsyslog default file permissions are configured.
# RSyslog will create logfiles that do not already exist on the system. This setting controls what per...
[CIS - Alma Linux 10 - Ensure rsyslog default file permissions are configured. {CIS: 4.2.1.4} {PCI_DSS: 10.2, 10.3}] [any] [https://www.cisecurity.org/ CIS: 4.2.1.4]
f:/etc/rsyslog.conf -> r:^\$FileCreateMode 0640|^\$FileCreateMode 0600|^\$FileCreateMode 0400;
d:/etc/rsyslog.d/ -> r:.+\.conf -> r:^\$FileCreateMode 0640|^\$FileCreateMode 0600|^\$FileCreateMode 0400;

# 38123 Ensure rsyslog is not configured to receive logs from a remote client.
# RSyslog supports the ability to receive messages from remote hosts, thus acting as a log server. Cli...
[CIS - Alma Linux 10 - Ensure rsyslog is not configured to receive logs from a remote client. {CIS: 4.2.1.7} {PCI_DSS: 1.1.6, 1.2.1}] [all] [https://www.cisecurity.org/ CIS: 4.2.1.7]
!d:/etc/rsyslog.d -> r:.+\.conf$ -> r:^\s*\t*\$ModLoad imtcp|\s*\t*^\$InputTCPServerRun|^\s*\t*module load="imtcp"|^\s*\t*input type="imtcp" port="514;
!f:/etc/rsyslog.conf -> r:^\s*\t*\$ModLoad imtcp|^\s*\t*\$InputTCPServerRun|^\s*\t*module load="imtcp"|^\s*\t*input type="imtcp" port="514;

# 38124 Ensure systemd-journal-remote is installed.
# Journald (via systemd-journal-remote) supports the ability to send log events it gathers to a remote...
[CIS - Alma Linux 10 - Ensure systemd-journal-remote is installed. {CIS: 4.2.2.1.1} {PCI_DSS: 10.2, 10.3}] [all] [https://www.cisecurity.org/ CIS: 4.2.2.1.1]
c:rpm -q systemd-journal-remote -> r:^systemd-journal-remote-;

# 38125 Ensure systemd-journal-remote is enabled.
# Journald (via systemd-journal-remote) supports the ability to send log events it gathers to a remote...
[CIS - Alma Linux 10 - Ensure systemd-journal-remote is enabled. {CIS: 4.2.2.1.3} {PCI_DSS: 10.2, 10.3}] [all] [https://www.cisecurity.org/ CIS: 4.2.2.1.3]
c:systemctl is-enabled systemd-journal-upload.service -> r:^\s*\t*enabled$;

# 38126 Ensure journald is not configured to receive logs from a remote client.
# Journald supports the ability to receive messages from remote hosts, thus acting as a log server. Cl...
[CIS - Alma Linux 10 - Ensure journald is not configured to receive logs from a remote client. {CIS: 4.2.2.1.4} {PCI_DSS: 1.1.6, 1.2.1}] [all] [https://www.cisecurity.org/ CIS: 4.2.2.1.4]
c:systemctl is-enabled systemd-journal-remote.socket -> r:^masked;

# 38127 Ensure journald service is enabled.
# Ensure that the systemd-journald service is enabled to allow capturing of logging events.
[CIS - Alma Linux 10 - Ensure journald service is enabled. {CIS: 4.2.2.2} {PCI_DSS: 10.2, 10.3}] [all] [https://www.cisecurity.org/ CIS: 4.2.2.2]
c:systemctl is-enabled systemd-journald.service -> r:^static;

# 38128 Ensure journald is configured to compress large log files.
# The journald system includes the capability of compressing overly large files to avoid filling up th...
[CIS - Alma Linux 10 - Ensure journald is configured to compress large log files. {CIS: 4.2.2.3} {PCI_DSS: 10.2, 10.3}] [all] [https://www.cisecurity.org/ CIS: 4.2.2.3]
f:/etc/systemd/journald.conf -> r:^\s*Compress=yes;

# 38129 Ensure journald is configured to write logfiles to persistent disk.
# Data from journald may be stored in volatile memory or persisted locally on the server. Logs in memo...
[CIS - Alma Linux 10 - Ensure journald is configured to write logfiles to persistent disk. {CIS: 4.2.2.4} {PCI_DSS: 10.2, 10.3}] [all] [https://www.cisecurity.org/ CIS: 4.2.2.4]
f:/etc/systemd/journald.conf -> r:^\s*Storage=persistent;

# 38130 Ensure journald is not configured to send logs to rsyslog.
# Data from journald should be kept in the confines of the service and not forwarded on to other servi...
[CIS - Alma Linux 10 - Ensure journald is not configured to send logs to rsyslog. {CIS: 4.2.2.5} {PCI_DSS: 10.2, 10.3}] [all] [https://www.cisecurity.org/ CIS: 4.2.2.5]
!f:/etc/systemd/journald.conf -> r:^\s*\t*ForwardToSyslog\s*=\s*yes;

# 38131 Ensure all logfiles have appropriate permissions and ownership.
# Log files contain information from many services on the local system, or in the event of a centraliz...
[CIS - Alma Linux 10 - Ensure all logfiles have appropriate permissions and ownership. {CIS: 4.2.3} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 4.2.3]
!c:sh -c "find /var/log/ -type f -perm /g+wx,o+rwx -exec ls -l "{}" +" -> r:[\w@-]+;

# 38132 Ensure cron daemon is enabled.
# The cron daemon is used to execute batch jobs on the system.
[CIS - Alma Linux 10 - Ensure cron daemon is enabled. {CIS: 5.1.1}] [all] [https://www.cisecurity.org/ CIS: 5.1.1]
c:systemctl is-enabled crond -> r:^enabled;

# 38133 Ensure permissions on /etc/crontab are configured.
# The /etc/crontab file is used by cron to control its own jobs. The commands in this item make sure t...
[CIS - Alma Linux 10 - Ensure permissions on /etc/crontab are configured. {CIS: 5.1.2} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 5.1.2]
c:stat -L /etc/crontab -> r:Access:\s*\(0\d00/-[\w@-][\w@-]-------\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\);

# 38134 Ensure permissions on /etc/cron.hourly are configured.
# This directory contains system cron jobs that need to run on an hourly basis. The files in this dire...
[CIS - Alma Linux 10 - Ensure permissions on /etc/cron.hourly are configured. {CIS: 5.1.3} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 5.1.3]
c:stat -L /etc/cron.hourly -> r:Access:\s*\(0\d00/[\w@-][\w@-][\w@-][\w@-]------\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\);

# 38135 Ensure permissions on /etc/cron.daily are configured.
# The /etc/cron.daily directory contains system cron jobs that need to run on a daily basis. The files...
[CIS - Alma Linux 10 - Ensure permissions on /etc/cron.daily are configured. {CIS: 5.1.4} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 5.1.4]
c:stat -L /etc/cron.daily -> r:Access:\s*\(0700/drwx------\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\);

# 38136 Ensure permissions on /etc/cron.weekly are configured.
# The /etc/cron.weekly directory contains system cron jobs that need to run on a weekly basis. The fil...
[CIS - Alma Linux 10 - Ensure permissions on /etc/cron.weekly are configured. {CIS: 5.1.5} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 5.1.5]
c:stat -L /etc/cron.weekly -> r:Access:\s*\(0\d00/[\w@-][\w@-][\w@-][\w@-]------\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\);

# 38137 Ensure permissions on /etc/cron.monthly are configured.
# The /etc/cron.monthly directory contains system cron jobs that need to run on a monthly basis. The f...
[CIS - Alma Linux 10 - Ensure permissions on /etc/cron.monthly are configured. {CIS: 5.1.6} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 5.1.6]
c:stat -L /etc/cron.monthly -> r:Access:\s*\(0\d00/[\w@-][\w@-][\w@-][\w@-]------\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\);

# 38138 Ensure permissions on /etc/cron.d are configured.
# The /etc/cron.d directory contains system cron jobs that need to run in a similar manner to the hour...
[CIS - Alma Linux 10 - Ensure permissions on /etc/cron.d are configured. {CIS: 5.1.7} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 5.1.7]
c:stat -L /etc/cron.d -> r:Access:\s*\(0\d00/[\w@-][\w@-][\w@-][\w@-]------\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\);

# 38139 Ensure cron is restricted to authorized users.
# If cron is installed in the system, configure /etc/cron.allow to allow specific users to use these s...
[CIS - Alma Linux 10 - Ensure cron is restricted to authorized users. {CIS: 5.1.8} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 5.1.8]
!f:/etc/cron.deny;
c:stat /etc/cron.allow/ -> r:Access:\s*\t*\(0640/-rw-r-----\)\s*\t*Uid:\s*\t*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\t*\(\s*\t*0/\s*\t*root\);

# 38140 Ensure at is restricted to authorized users.
# If at is installed in the system, configure /etc/at.allow to allow specific users to use these servi...
[CIS - Alma Linux 10 - Ensure at is restricted to authorized users. {CIS: 5.1.9} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 5.1.9]
!f:/etc/at.deny;
c:stat /etc/at.allow/ -> r:Access:\s*\t*\(0640/-rw-r-----\)\s*\t*Uid:\s*\t*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\t*\(\s*\t*0/\s*\t*root\);

# 38141 Ensure permissions on /etc/ssh/sshd_config are configured.
# The /etc/ssh/sshd_config file contains configuration specifications for sshd. The command below sets...
[CIS - Alma Linux 10 - Ensure permissions on /etc/ssh/sshd_config are configured. {CIS: 5.2.1} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 5.2.1]
c:stat /etc/ssh/sshd_config -> r:Access:\s*\t*\(0600/-rw-------\)\s*\t*Uid:\s*\t*\(\s*\t*0/\s*root\)\s*Gid:\s*\t*\(\s*\t*0/\s*\t*root\);

# 38142 Ensure SSH access is limited.
# There are several options available to limit which users and group can access the system via SSH. It...
[CIS - Alma Linux 10 - Ensure SSH access is limited. {CIS: 5.2.4} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 5.2.4]
c:sshd -T -> r:^\s*\t*Allowusers\s*\t*[\w@-]+|^\s*\t*Denyusers\s*\t*[\w@-]+|^\s*\t*Allowgroups\s*\t*[\w@-]+|^\s*\t*Denygroups\s*\t*[\w@-]+;
f:/etc/ssh/sshd_config -> r:^\s*\t*Allowusers\s*\t*[\w@-]+|^\s*\t*Denyusers\s*\t*[\w@-]+|^\s*\t*Allowgroups\s*\t*[\w@-]+|^\s*\t*Denygroups\s*\t*[\w@-]+;
d:/etc/ssh/sshd_config.d -> r:.* -> r:^\s*\t*Allowusers\s*\t*[\w@-]+|^\s*\t*Denyusers\s*\t*[\w@-]+|^\s*\t*Allowgroups\s*\t*[\w@-]+|^\s*\t*Denygroups\s*\t*[\w@-]+;

# 38143 Ensure SSH LogLevel is appropriate.
# INFO level is the basic level that only records login activity of SSH users. In many situations, suc...
[CIS - Alma Linux 10 - Ensure SSH LogLevel is appropriate. {CIS: 5.2.5} {PCI_DSS: 10.2, 10.3}] [any] [https://www.cisecurity.org/ CIS: 5.2.5]
c:sshd -T -> r:^loglevel VERBOSE|^loglevel INFO;
!f:/etc/ssh/sshd_config -> !r:^\s*\t*loglevel\s*\t*VERBOSE|^\s*\t*loglevel\s*\t*INFO;

# 38144 Ensure SSH PAM is enabled.
# UsePAM Enables the Pluggable Authentication Module interface. If set to "yes" this will enable PAM a...
[CIS - Alma Linux 10 - Ensure SSH PAM is enabled. {CIS: 5.2.6}] [all] [https://www.cisecurity.org/ CIS: 5.2.6]
c:sshd -T -> r:^usepam yes;
!f:/etc/ssh/sshd_config -> r:^\s*\t*UsePAM\s*\t*no;

# 38145 Ensure SSH root login is disabled.
# The PermitRootLogin parameter specifies if the root user can log in using ssh. The default is no.
[CIS - Alma Linux 10 - Ensure SSH root login is disabled. {CIS: 5.2.7} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 5.2.7]
c:sshd -T -> r:^permitrootlogin no;
f:/etc/ssh/sshd_config -> r:^\s*\t*PermitRootLogin\s*\t*no;

# 38146 Ensure SSH HostbasedAuthentication is disabled.
# The HostbasedAuthentication parameter specifies if authentication is allowed through trusted hosts v...
[CIS - Alma Linux 10 - Ensure SSH HostbasedAuthentication is disabled. {CIS: 5.2.8} {PCI_DSS: 11.5, 2.2}] [all] [https://www.cisecurity.org/ CIS: 5.2.8]
c:sshd -T -> r:^hostbasedauthentication no;
!f:/etc/ssh/sshd_config -> r:^\s*\t*HostBasedAuthentication\s*\t*yes;

# 38147 Ensure SSH PermitEmptyPasswords is disabled.
# The PermitEmptyPasswords parameter specifies if the SSH server allows login to accounts with empty p...
[CIS - Alma Linux 10 - Ensure SSH PermitEmptyPasswords is disabled. {CIS: 5.2.9} {PCI_DSS: 2.2.2, 8.3.5}] [all] [https://www.cisecurity.org/ CIS: 5.2.9]
c:sshd -T -> r:^permitemptypasswords no;
!f:/etc/ssh/sshd_config -> r:^\s*\t*PermitEmptyPasswords\s*\t*yes;

# 38148 Ensure SSH PermitUserEnvironment is disabled.
# The PermitUserEnvironment option allows users to present environment options to the ssh daemon.
[CIS - Alma Linux 10 - Ensure SSH PermitUserEnvironment is disabled. {CIS: 5.2.10} {PCI_DSS: 11.5, 2.2}] [all] [https://www.cisecurity.org/ CIS: 5.2.10]
c:sshd -T -> r:^permituserenvironment no;
!f:/etc/ssh/sshd_config -> r:^\s*\t*PermitUserEnvironment\s*\t*yes;

# 38149 Ensure SSH IgnoreRhosts is enabled.
# The IgnoreRhosts parameter specifies that .rhosts and .shosts files will not be used in RhostsRSAAut...
[CIS - Alma Linux 10 - Ensure SSH IgnoreRhosts is enabled. {CIS: 5.2.11}] [all] [https://www.cisecurity.org/ CIS: 5.2.11]
c:sshd -T -> r:^ignorerhosts yes;
!f:/etc/ssh/sshd_config -> r:^\s*\t*IgnoreRhosts\s*\t*no;

# 38150 Ensure SSH X11 forwarding is disabled.
# The X11Forwarding parameter provides the ability to tunnel X11 traffic through the connection to ena...
[CIS - Alma Linux 10 - Ensure SSH X11 forwarding is disabled. {CIS: 5.2.12} {PCI_DSS: 1.1.6, 1.2.1}] [all] [https://www.cisecurity.org/ CIS: 5.2.12]
c:sshd -T -> r:^x11forwarding no;
!f:/etc/ssh/sshd_config -> r:^\s*\t*x11forwarding\s*\t*yes;

# 38151 Ensure SSH AllowTcpForwarding is disabled.
# SSH port forwarding is a mechanism in SSH for tunneling application ports from the client to the ser...
[CIS - Alma Linux 10 - Ensure SSH AllowTcpForwarding is disabled. {CIS: 5.2.13} {PCI_DSS: 11.5, 2.2}] [all] [https://www.cisecurity.org/ CIS: 5.2.13]
c:sshd -T -> r:^allowtcpforwarding && r:no$;
!f:/etc/ssh/sshd_config -> r:^\s*\t*AllowTcpForwarding\s*\t*yes;

# 38152 Ensure system-wide crypto policy is not over-ridden.
# System-wide Crypto policy can be over-ridden or opted out of for openSSH.
[CIS - Alma Linux 10 - Ensure system-wide crypto policy is not over-ridden. {CIS: 5.2.14} {PCI_DSS: 2.1.1, 4.1}] [all] [https://www.cisecurity.org/ CIS: 5.2.14]
!f:/etc/sysconfig/sshd -> ^\s*CRYPTO_POLICY=;

# 38153 Ensure SSH warning banner is configured.
# The Banner parameter specifies a file whose contents must be sent to the remote user before authenti...
[CIS - Alma Linux 10 - Ensure SSH warning banner is configured. {CIS: 5.2.15}] [all] [https://www.cisecurity.org/ CIS: 5.2.15]
c:sshd -T -> r:^banner && r:/etc/issue\.net$;

# 38154 Ensure SSH MaxAuthTries is set to 4 or less.
# The MaxAuthTries parameter specifies the maximum number of authentication attempts permitted per con...
[CIS - Alma Linux 10 - Ensure SSH MaxAuthTries is set to 4 or less. {CIS: 5.2.16} {PCI_DSS: 10.1, 10.2.2}] [all] [https://www.cisecurity.org/ CIS: 5.2.16]
c:sshd -T -> n:^maxauthtries\s+(\d+) compare <= 4;
!f:/etc/ssh/sshd_config -> n:^\s*\t*maxauthtries\s+(\d+) compare > 4;

# 38155 Ensure SSH MaxStartups is configured.
# The MaxStartups parameter specifies the maximum number of concurrent unauthenticated connections to ...
[CIS - Alma Linux 10 - Ensure SSH MaxStartups is configured. {CIS: 5.2.17} {PCI_DSS: 11.5, 2.2}] [all] [https://www.cisecurity.org/ CIS: 5.2.17]
c:sshd -T -> n:^\s*maxstartups\s+(\d+):\d+:\d+ compare <= 10 && n:^maxstartups\s+(\d+):\d+:\d+ compare >= 1;
c:sshd -T -> n:^\s*maxstartups\s+\d+:(\d+):\d+ compare <= 30 && n:^maxstartups\s+(\d+):\d+:\d+ compare >= 1;
c:sshd -T -> n:^\s*maxstartups\s+\d+:\d+:(\d+) compare <= 60 && n:^maxstartups\s+(\d+):\d+:\d+ compare >= 1;
!f:/etc/ssh/sshd_config -> n:^\s*\t*MaxStartups\s*\t*(\d+):\d+:\d+ compare > 10;
!f:/etc/ssh/sshd_config -> n:^\s*\t*MaxStartups\s*\t*(\d+):\d+:\d+ compare == 0;
!f:/etc/ssh/sshd_config -> n:^\s*\t*MaxStartups\s*\t*\d+:(\d+):\d+ compare > 30;
!f:/etc/ssh/sshd_config -> n:^\s*\t*MaxStartups\s*\t*\d+:(\d+):\d+ compare == 0;
!f:/etc/ssh/sshd_config -> n:^\s*\t*MaxStartups\s*\t*\d+:\d+:(\d+) compare > 60;
!f:/etc/ssh/sshd_config -> n:^\s*\t*MaxStartups\s*\t*\d+:\d+:(\d+) compare == 0;

# 38156 Ensure SSH MaxSessions is set to 10 or less.
# The MaxSessions parameter specifies the maximum number of open sessions permitted from a given conne...
[CIS - Alma Linux 10 - Ensure SSH MaxSessions is set to 10 or less. {CIS: 5.2.18}] [all] [https://www.cisecurity.org/ CIS: 5.2.18]
c:sshd -T -> n:^maxsessions\s*\t*(\d+) compare <= 10;
!f:/etc/ssh/sshd_config -> n:^^\s*\t*MaxSessions\s+(\d+) compare > 10;

# 38157 Ensure SSH LoginGraceTime is set to one minute or less.
# The LoginGraceTime parameter specifies the time allowed for successful authentication to the SSH ser...
[CIS - Alma Linux 10 - Ensure SSH LoginGraceTime is set to one minute or less. {CIS: 5.2.19}] [all] [https://www.cisecurity.org/ CIS: 5.2.19]
c:sshd -T -> n:^\s*logingracetime\s*(\d+) compare <= 60 && n:^logingracetime\s*(\d+) compare >= 1;
!f:/etc/ssh/sshd_config -> n:^\s*\t*LoginGraceTime\s*\t*(\d+) compare > 60;
!f:/etc/ssh/sshd_config -> n:^\s*\t*LoginGraceTime\s*\t*(\d+) compare == 0;

# 38158 Ensure SSH Idle Timeout Interval is configured.
# NOTE: To clarify, the two settings described below are only meant for idle connections from a protoc...
[CIS - Alma Linux 10 - Ensure SSH Idle Timeout Interval is configured. {CIS: 5.2.20}] [all] [https://www.cisecurity.org/ CIS: 5.2.20]
c:sshd -T -> -> n:^clientaliveinterval\s*\t*(\d+) compare > 0;
c:sshd -T -> -> n:^clientalivecountmax\s*\t*(\d+) compare > 0;

# 38159 Ensure sudo is installed.
# sudo allows a permitted user to execute a command as the superuser or another user, as specified by ...
[CIS - Alma Linux 10 - Ensure sudo is installed. {CIS: 5.3.1} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 5.3.1]
c:dnf list sudo -> r:^sudo\.x86_64;

# 38160 Ensure sudo commands use pty.
# sudo can be configured to run only from a pseudo terminal (pseudo-pty).
[CIS - Alma Linux 10 - Ensure sudo commands use pty. {CIS: 5.3.2} {PCI_DSS: 7.1, 7.1.1}] [any] [https://www.cisecurity.org/ CIS: 5.3.2]
f:/etc/sudoers -> r:^\s*\t*Defaults\s*\t*use_pty;
d:/etc/sudoers.d -> r:.* -> r:^\s*\t*Defaults\s*\t*use_pty;

# 38161 Ensure sudo log file exists.
# sudo can use a custom log file.
[CIS - Alma Linux 10 - Ensure sudo log file exists. {CIS: 5.3.3} {PCI_DSS: 10.1, 10.2.2}] [all] [https://www.cisecurity.org/ CIS: 5.3.3]
f:/etc/sudoers -> r:^\s*\t*Defaults\s*\t*logfile=;
d:/etc/sudoers.d -> r:.* -> r:^\s*\t*Defaults\s*\t*logfile=;

# 38162 Ensure users must provide password for escalation.
# The operating system must be configured so that users must provide a password for privilege escalati...
[CIS - Alma Linux 10 - Ensure users must provide password for escalation. {CIS: 5.3.4} {PCI_DSS: 7.1, 7.1.1}] [any] [https://www.cisecurity.org/ CIS: 5.3.4]
f:/etc/sudoers -> !r:^\s*\t*# && r:NOPASSWD;
d:/etc/sudoers.d -> r:.* -> !r:^\s*\t*# && r:NOPASSWD;

# 38163 Ensure re-authentication for privilege escalation is not disabled globally.
# The operating system must be configured so that users must re-authenticate for privilege escalation.
[CIS - Alma Linux 10 - Ensure re-authentication for privilege escalation is not disabled globally. {CIS: 5.3.5} {PCI_DSS: 7.1, 7.1.1}] [any] [https://www.cisecurity.org/ CIS: 5.3.5]
f:/etc/sudoers -> !r:^\s*\t*# && r:!authenticate;
d:/etc/sudoers.d -> r:.* -> !r:^\s*\t*# && r:!authenticate;

# 38164 Ensure sudo authentication timeout is configured correctly.
# sudo caches used credentials for a default of 5 minutes. This is for ease of use when there are mult...
[CIS - Alma Linux 10 - Ensure sudo authentication timeout is configured correctly. {CIS: 5.3.6} {PCI_DSS: 7.1, 7.1.1}] [any] [https://www.cisecurity.org/ CIS: 5.3.6]
c:sudo -V -> r:Authentication timestamp timeout:\s*\t*15\.0 minutes;
f:/etc/sudoers -> n:timestamp_timeout=(\d+) compare < 15 && n:timestamp_timeout=(\d+) compare != -1;

# 38165 Ensure access to the su command is restricted.
# The su command allows a user to run a command or shell as another user. The program has been superse...
[CIS - Alma Linux 10 - Ensure access to the su command is restricted. {CIS: 5.3.7} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 5.3.7]
f:/etc/pam.d/su -> !r:^\s*\t*# && r:auth\s*\t*required\s*\t*pam_wheel\.so && r:use_uid && r:group=[\w@-]+;

# 38166 Ensure authselect includes with-faillock.
# The pam_faillock.so module maintains a list of failed authentication attempts per user during a spec...
[CIS - Alma Linux 10 - Ensure authselect includes with-faillock. {CIS: 5.4.2} {PCI_DSS: 11.5, 2.2}] [all] [https://www.cisecurity.org/ CIS: 5.4.2]
f:/etc/pam.d/password-auth -> r:required && r:pam_faillock\.so;
f:/etc/pam.d/system-auth -> r:required && r:pam_faillock\.so;

# 38167 Ensure password creation requirements are configured.
# The pam_pwquality.so module checks the strength of passwords. It performs checks such as making sure...
[CIS - Alma Linux 10 - Ensure password creation requirements are configured. {CIS: 5.5.1} {PCI_DSS: 2.2.2, 8.3.5}] [all] [https://www.cisecurity.org/ CIS: 5.5.1]
f:/etc/pam.d/password-auth -> r:pam_pwquality\.so && r:try_first_pass && r:retry=;
f:/etc/pam.d/system-auth -> r:pam_pwquality\.so && r:try_first_pass && r:retry=;
f:/etc/security/pwquality.conf -> n:^\s*minlen\s+\t*=\s+\t*(\d+) compare >= 14;
f:/etc/security/pwquality.conf -> r:^\s*minclass|^\s*\Scredit;

# 38168 Ensure lockout for failed password attempts is configured.
# Lock out users after n unsuccessful consecutive login attempts. - deny=<n> - Number of attempts befo...
[CIS - Alma Linux 10 - Ensure lockout for failed password attempts is configured. {CIS: 5.5.2} {PCI_DSS: 8.1.3}] [all] [https://www.cisecurity.org/ CIS: 5.5.2]
f:/etc/pam.d/password-auth -> !r:^\s*\t*# && r:auth\s*\t*required\s*\t*pam_faillock\.so\s*preauth;
f:/etc/pam.d/password-auth -> !r:^\s*\t*# && r:auth && r:required && r:\s*\t*pam_faillock\.so && r:\s*\t*authfail;
f:/etc/pam.d/system-auth -> !r:^\s*\t*# && r:auth\s*\t*required\s*\t*pam_faillock\.so\s*preauth;
f:/etc/pam.d/system-auth -> !r:^\s*\t*# && r:auth\s*\t*required\s*\t*pam_faillock\.so;
f:/etc/security/faillock.conf -> !r:^\s*\t*# && n:deny\s*\t*=\s*\t*(\d+) compare <= 5;
f:/etc/security/faillock.conf -> !r:^\s*\t*# && n:fail_interval\s*\t*=\s*\t*(\d+) compare <= 900;

# 38169 Ensure password reuse is limited.
# The /etc/security/opasswd file stores the users' old passwords and can be checked to ensure that use...
[CIS - Alma Linux 10 - Ensure password reuse is limited. {CIS: 5.5.3} {PCI_DSS: 2.2.2, 8.3.5}] [all] [https://www.cisecurity.org/ CIS: 5.5.3]
f:/etc/pam.d/system-auth -> !r:^\s*\t*# && r:password\s*\t*requisite|password\s*\t*sufficient && r:pam_pwhistory\.so|pam_unix\.so && n:remember\s*\t*=\s*\t*(\d+) compare => 5;

# 38170 Ensure password hashing algorithm is SHA-512 or yescrypt.
# A cryptographic hash function converts an arbitrary-length input into a fixed length output. Passwor...
[CIS - Alma Linux 10 - Ensure password hashing algorithm is SHA-512 or yescrypt. {CIS: 5.5.4} {PCI_DSS: 3.4, 3.4.1}] [all] [https://www.cisecurity.org/ CIS: 5.5.4]
f:/etc/login.defs -> r:\s*ENCRYPT_METHOD SHA512;
f:/etc/libuser.conf -> r:\s*crypt_style = sha512;
f:/etc/pam.d/password-auth -> r:\s*password && r:requisite|required|sufficient && r:pam_unix\.so && r:sha512;
f:/etc/pam.d/system-auth -> r:\s*password && r:requisite|required|sufficient && r:pam_unix\.so && r:sha512;

# 38171 Ensure password expiration is 365 days or less.
# The PASS_MAX_DAYS parameter in /etc/login.defs allows an administrator to force passwords to expire ...
[CIS - Alma Linux 10 - Ensure password expiration is 365 days or less. {CIS: 5.6.1.1} {PCI_DSS: 11.5, 2.2}] [all] [https://www.cisecurity.org/ CIS: 5.6.1.1]
f:/etc/login.defs -> n:^\s*\t*PASS_MAX_DAYS\s*\t*(\d+) compare <= 365;
!f:/etc/shadow -> n:^[\w@-]+:\$.*:\d+:\d+:(\d+): compare > 365;

# 38172 Ensure minimum days between password changes is configured.
# The PASS_MIN_DAYS parameter in /etc/login.defs allows an administrator to prevent users from changin...
[CIS - Alma Linux 10 - Ensure minimum days between password changes is configured. {CIS: 5.6.1.2} {PCI_DSS: 2.2.2, 8.3.5}] [all] [https://www.cisecurity.org/ CIS: 5.6.1.2]
f:/etc/login.defs -> n:^\s*\t*PASS_MIN_DAYS\s*\t*(\d+) compare >= 7;
!f:/etc/shadow -> n:^[\w@-]+:\$.*:\d+:(\d+): compare < 7;

# 38173 Ensure password expiration warning days is 7 or more.
# The PASS_WARN_AGE parameter in /etc/login.defs allows an administrator to notify users that their pa...
[CIS - Alma Linux 10 - Ensure password expiration warning days is 7 or more. {CIS: 5.6.1.3} {PCI_DSS: 11.5, 2.2}] [all] [https://www.cisecurity.org/ CIS: 5.6.1.3]
f:/etc/login.defs -> n:^\s*\t*PASS_WARN_AGE\s*\t*(\d+) compare >= 7;
!f:/etc/shadow -> n:^[\w@-]+:\$.*:\d+:\d+:\d+:(\d+): compare < 7;

# 38174 Ensure inactive password lock is 30 days or less.
# User accounts that have been inactive for over a given period of time can be automatically disabled....
[CIS - Alma Linux 10 - Ensure inactive password lock is 30 days or less. {CIS: 5.6.1.4} {PCI_DSS: 2.2.2, 8.3.5}] [all] [https://www.cisecurity.org/ CIS: 5.6.1.4]
c:useradd -D -> n:^INACTIVE=(\d+) compare <= 30;
!c:useradd -D -> r:^INACTIVE=-1;
!f:/etc/shadow -> n:^[\w@-]+:[\w@-]+:[\w@-]+:[\w@-]+:[\w@-]+:[\w@-]+:(\d+): compare > 30;
!f:/etc/shadow -> r:^[\w@-]+:[\w@-]+:[\w@-]+:[\w@-]+:[\w@-]+:[\w@-]+:-1:;

# 38175 Ensure default group for the root account is GID 0.
# The usermod command can be used to specify which group the root account belongs to. This affects per...
[CIS - Alma Linux 10 - Ensure default group for the root account is GID 0. {CIS: 5.6.4} {PCI_DSS: 11.5, 2.2}] [all] [https://www.cisecurity.org/ CIS: 5.6.4]
f:/etc/passwd -> !r:^\s*\t*# && r:root:[\w@-]+:[\w@-]+:0:;

# 38176 Ensure permissions on /etc/passwd are configured.
# The /etc/passwd file contains user account information that is used by many system utilities and the...
[CIS - Alma Linux 10 - Ensure permissions on /etc/passwd are configured. {CIS: 6.1.1} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 6.1.1]
c:stat -Lc "%n %a %u %U %g %G" /etc/passwd -> r:0 root 0 root && r:644|640|604|600|400|500;

# 38177 Ensure permissions on /etc/passwd- are configured.
# The /etc/passwd- file contains backup user account information.
[CIS - Alma Linux 10 - Ensure permissions on /etc/passwd- are configured. {CIS: 6.1.2} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 6.1.2]
c:stat -Lc "%n %a %u %U %g %G" /etc/passwd- -> r:0 root 0 root && r:644|640|604|600|400|500;

# 38178 Ensure permissions on /etc/group are configured.
# The /etc/group file contains a list of all the valid groups defined in the system. The command below...
[CIS - Alma Linux 10 - Ensure permissions on /etc/group are configured. {CIS: 6.1.3} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 6.1.3]
c:stat -Lc "%n %a %u %U %g %G" /etc/group -> r:0 root 0 root && r:644|640|604|600|400|500;

# 38179 Ensure permissions on /etc/group- are configured.
# The /etc/group- file contains a backup list of all the valid groups defined in the system.
[CIS - Alma Linux 10 - Ensure permissions on /etc/group- are configured. {CIS: 6.1.4} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 6.1.4]
c:stat -Lc "%n %a %u %U %g %G" /etc/group- -> r:0 root 0 root && r:644|640|604|600|400|500;

# 38180 Ensure permissions on /etc/shadow are configured.
# The /etc/shadow file is used to store the information about user accounts that is critical to the se...
[CIS - Alma Linux 10 - Ensure permissions on /etc/shadow are configured. {CIS: 6.1.5} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 6.1.5]
c:stat -Lc "%n %a %u %U %g %G" /etc/shadow -> r:0 root 0 root && n:shadow (\d+) compare == 0;

# 38181 Ensure permissions on /etc/shadow- are configured.
# The /etc/shadow- file is used to store backup information about user accounts that is critical to th...
[CIS - Alma Linux 10 - Ensure permissions on /etc/shadow- are configured. {CIS: 6.1.6} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 6.1.6]
c:stat -Lc "%n %a %u %U %g %G" /etc/shadow- -> r:0 root 0 root && n:shadow- (\d+) compare == 0;

# 38182 Ensure permissions on /etc/gshadow are configured.
# The /etc/gshadow file is used to store the information about groups that is critical to the security...
[CIS - Alma Linux 10 - Ensure permissions on /etc/gshadow are configured. {CIS: 6.1.7} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 6.1.7]
c:stat -Lc "%n %a %u %U %g %G" /etc/gshadow -> r:0 root 0 root && n:gshadow (\d+) compare == 0;

# 38183 Ensure permissions on /etc/gshadow- are configured.
# The /etc/gshadow- file is used to store backup information about groups that is critical to the secu...
[CIS - Alma Linux 10 - Ensure permissions on /etc/gshadow- are configured. {CIS: 6.1.8} {PCI_DSS: 7.1, 7.1.1}] [all] [https://www.cisecurity.org/ CIS: 6.1.8]
c:stat -Lc "%n %a %u %U %g %G" /etc/gshadow- -> r:0 root 0 root && n:gshadow- (\d+) compare == 0;

# 38184 Ensure accounts in /etc/passwd use shadowed passwords.
# Local accounts can use shadowed passwords. With shadowed passwords, the passwords are saved in shado...
[CIS - Alma Linux 10 - Ensure accounts in /etc/passwd use shadowed passwords. {CIS: 6.2.1} {PCI_DSS: 3.4, 3.4.1}] [any] [https://www.cisecurity.org/ CIS: 6.2.1]
f:/etc/passwd -> !r:^[\w@-]+:x:;

# 38185 Ensure /etc/shadow password fields are not empty.
# An account with an empty password field means that anybody may log in as that user without providing...
[CIS - Alma Linux 10 - Ensure /etc/shadow password fields are not empty. {CIS: 6.2.2} {PCI_DSS: 2.2.2, 8.3.5}] [any] [https://www.cisecurity.org/ CIS: 6.2.2]
f:/etc/shadow -> r:^[\w@-]+::;

# 38186 Ensure root is the only UID 0 account.
# Any account with UID 0 has superuser privileges on the system.
[CIS - Alma Linux 10 - Ensure root is the only UID 0 account. {CIS: 6.2.9}] [all] [https://www.cisecurity.org/ CIS: 6.2.9]
!f:/etc/passwd -> !r:^\s*\t*# && !r:^root: && r:^[\w@-]+:[\w@-]+:0:;

